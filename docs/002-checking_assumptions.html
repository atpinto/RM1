<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Checking Assumptions – Regression Modelling for Biostatistics 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./003-binary_covariates_and_outliers.html" rel="next">
<link href="./001-simple_linear_regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-73e053f00451a6823eaeab9714ac17cd.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6d90ce357d03a3cacecb70eea96b5016.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./002-checking_assumptions.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Checking Assumptions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/bca.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression Modelling for Biostatistics 1</a> 
        <div class="sidebar-tools-main">
    <a href="./Regression-Modelling-for-Biostatistics-1.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001-simple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002-checking_assumptions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Checking Assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./003-binary_covariates_and_outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Binary Covariates, Outliers, and Influential Observations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./004-multiple_linear_regression_application.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Multiple Linear Regression - Application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005-lin_reg_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple linear regression theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006-interaction_collinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Interaction and Collinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./007-lin_reg_splines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Violations of assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./008-model_building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regression model building and variable selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./009-logistic_regression_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-logistic_regression_conf_inter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011-logistic_regression_splines_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012-logistic_regression_model_building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">model building for binary outcomes</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learn_obj_wk02" id="toc-learn_obj_wk02" class="nav-link active" data-scroll-target="#learn_obj_wk02">Learning objectives</a></li>
  <li><a href="#learn_act_wk02" id="toc-learn_act_wk02" class="nav-link" data-scroll-target="#learn_act_wk02">Learning activities</a>
  <ul class="collapse">
  <li><a href="#collaborative-exercise-reminder" id="toc-collaborative-exercise-reminder" class="nav-link" data-scroll-target="#collaborative-exercise-reminder">Collaborative exercise reminder</a></li>
  </ul></li>
  <li><a href="#video_wk02_resid" id="toc-video_wk02_resid" class="nav-link" data-scroll-target="#video_wk02_resid">Assumptions of linear regression</a>
  <ul class="collapse">
  <li><a href="#linearity" id="toc-linearity" class="nav-link" data-scroll-target="#linearity">Linearity</a></li>
  <li><a href="#homoscedasticity-constant-variance" id="toc-homoscedasticity-constant-variance" class="nav-link" data-scroll-target="#homoscedasticity-constant-variance">Homoscedasticity (constant variance)</a></li>
  <li><a href="#normalitiy" id="toc-normalitiy" class="nav-link" data-scroll-target="#normalitiy">Normalitiy</a></li>
  </ul></li>
  <li><a href="#worked-example" id="toc-worked-example" class="nav-link" data-scroll-target="#worked-example">Worked example</a></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations">Transformations</a>
  <ul class="collapse">
  <li><a href="#log-transformations-of-the-outcome" id="toc-log-transformations-of-the-outcome" class="nav-link" data-scroll-target="#log-transformations-of-the-outcome">Log transformations of the outcome</a></li>
  <li><a href="#log-transformations-of-the-outcome-and-covariates" id="toc-log-transformations-of-the-outcome-and-covariates" class="nav-link" data-scroll-target="#log-transformations-of-the-outcome-and-covariates">Log transformations of the outcome and covariates</a></li>
  </ul></li>
  <li><a href="#other-methods-for-handling-non-constant-variance" id="toc-other-methods-for-handling-non-constant-variance" class="nav-link" data-scroll-target="#other-methods-for-handling-non-constant-variance">Other methods for handling non-constant variance</a>
  <ul class="collapse">
  <li><a href="#weighted-least-squares" id="toc-weighted-least-squares" class="nav-link" data-scroll-target="#weighted-least-squares">Weighted least squares</a></li>
  </ul></li>
  <li><a href="#collaborative-exercise" id="toc-collaborative-exercise" class="nav-link" data-scroll-target="#collaborative-exercise">Collaborative exercise</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="checking_assumptions" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Checking Assumptions</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learn_obj_wk02" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learn_obj_wk02">Learning objectives</h2>
<p>By the end of this week you should be able to:</p>
<ol type="1">
<li><p>Use residuals to test simple linear regression assumptions</p></li>
<li><p>Recognise when transformations of the response and/or covariate may be needed and be familiar with common transformations</p></li>
<li><p>Derive the interpretation of regression coefficients after transformation</p></li>
</ol>
</section>
<section id="learn_act_wk02" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learn_act_wk02">Learning activities</h2>
<p>This week’s learning activities include:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Learning Activity</th>
<th>Learning objectives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Video 1</td>
<td>1</td>
</tr>
<tr class="even">
<td>Readings</td>
<td>1, 2, 3</td>
</tr>
<tr class="odd">
<td>Collaborative exercise</td>
<td>1, 2</td>
</tr>
</tbody>
</table>
<section id="collaborative-exercise-reminder" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="collaborative-exercise-reminder">Collaborative exercise reminder</h3>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <mar> week 1  you were allocated into small groups to discuss the exercise at the end of this week. You should have already organised a time with your group to meet up by zoom and either discuss your solutions to this exercise, or help and guide each other to complete the task.</mar></p>
</div>
</div>
</section>
</section>
<section id="video_wk02_resid" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="video_wk02_resid">Assumptions of linear regression</h2>
<p>In this section we introduce some simple methods for assessing the underlying assumptions of the simple regression model. For regression analysis we should always perform a reality check that the model we are fitting is at least approximately appropriate for the problem at hand. The assumptions of linear regression fitted by ordinary least squares are:</p>
<ol type="1">
<li><p>Linearity of the relationship</p></li>
<li><p>Homoscedasticity (constant variance)</p></li>
<li><p>Normality of the residuals</p></li>
<li><p>Independence of observations.</p></li>
</ol>
<p>As shown below, assumptions (1) - (3) can be defined in terms of the random part of the regression model - the residuals. The residuals are the observed minus the predicted Y’s, i.e.&nbsp;<span class="math inline">\(e_i = Y_i-\hat{Y}_i=Y_i-(b_0+b_1x_i)\)</span>. Assumption (4) however is usually an assessment of the study design rather than assessed with a diagnostic analysis of the data.</p>
<section id="linearity" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="linearity">Linearity</h3>
<p>This assumption requires a linear (straight) relationship between the outcome and predictor. The plot below shows the effect of a non-linear relationship on the residuals.</p>
<p><img src="images/Linearity_plots.jpg" class="img-fluid" style="width:100.0%"></p>
<p>In the first figure, the relationship is curved upwards and so when fitting a straight line through the data, the outcome value (<span class="math inline">\(Y\)</span>) is frequently above the regression line for small and large values of <span class="math inline">\(x\)</span>, and below the regression line in the middle. Although this is reasonably obvious in the scatter plot above, it is helpful to plot the actual residual values instead of the outcome as per the plot below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/resid_1.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>Note in this figure we plot the residuals against the <em>predicted</em> values of the regression line instead of the <span class="math inline">\(x\)</span>-values themselves. When there is just one predictor variable, as the regression line is linear this is equivalent to plotting against <span class="math inline">\(x\)</span>. The advantage to plotting against the fitted value is that this extends naturally into multivariable models. From this <em>residual vs.&nbsp;fitted</em> plot, we can also see that the linearity assumption could be rewritten in terms of the residuals. E.g. the residuals have a mean of zero for all values of <span class="math inline">\(x\)</span>.</p>
</section>
<section id="homoscedasticity-constant-variance" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="homoscedasticity-constant-variance">Homoscedasticity (constant variance)</h3>
<p>This assumption requires that the variance around the regression line is constant for all values of <span class="math inline">\(x\)</span>. That is, the residuals have <em>constant variance</em>. The “residual vs fitted” plot we looked at above is also useful for assessing violations of the homoscedasticity assumption, as illustrated in the scatter and residual vs fitted plots below.</p>
<p><img src="images/heteroscedasticity.jpg" class="img-fluid" style="width:100.0%"></p>
<p>Here, we can see that as <span class="math inline">\(x\)</span> increases, so does the variance of the residuals. This leads to a fanning out pattern in the residual vs fitted plot.</p>
<p>To contrast these plots, the below figures demonstrate what these plots look like when both the linearity and homoscedasticity assumptions are met.</p>
<p><img src="images/assumptions_met.jpg" class="img-fluid" style="width:100.0%"></p>
</section>
<section id="normalitiy" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="normalitiy">Normalitiy</h3>
<p>This assumption requires that the residuals be normally distributed. Note that this is an assumption about the distribution of the residuals, not about the distribution of <span class="math inline">\(Y\)</span> or <span class="math inline">\(x\)</span>. We can plot the residuals on a histogram or normal quantile plot to assess the normality of residuals assumption – which has clearly been met in the figures below.</p>
<p><img src="images/normality.jpg" class="img-fluid" style="width:100.0%"></p>
<p>A well-known formal method for assessing non-normality is the Shapiro-Wilk test. It is based approximately on the correlation between the observed and expected residuals. The null hypothesis is that the residuals are normally distributed, so small p-values indicate evidence against a normal distribution. However, for small samples this test has low power for realistic non-normal alternatives, so it is difficult to use a non-statistically-significant result as evidence to support an assumption of normality in a small sample. Conversely, for large samples, small but unimportant deviations from normality may be declared statistically. Therefore we do not recommend this (or other) formal statistical tests of normality. Rather a visual assessment of a histogram or normal quantile plot is recommended.</p>
</section>
</section>
<section id="worked-example" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="worked-example">Worked example</h2>
<div class="grid">
<section id="stata-lecture" class="level3 unnumbered g-col-6">
<h3 class="unnumbered anchored" data-anchor-id="stata-lecture">Stata Lecture</h3>
<p><a href="https://sydney.instructuremedia.com/embed/6db4263e-3964-4c8e-9121-62112a477d89" onclick="window.open(this.href, 'videoPopup', 'width=800,height=600'); return false;"> <img src="images/RM1_video.png" width="300"> </a></p>
</section>
<section id="r-lecture" class="level3 unnumbered g-col-6">
<h3 class="unnumbered anchored" data-anchor-id="r-lecture">R Lecture</h3>
<p><a href="https://sydney.instructuremedia.com/embed/eac8eebe-7b75-4e48-bb97-02a33d9677c4" onclick="window.open(this.href, 'videoPopup', 'width=800,height=600'); return false;"> <img src="images/RM1_video.png" width="300"> </a></p>
</section>
</div>
<p>Let’s check the assumptions of the regression the <a href="001-simple_linear_regression.html#exercise_wk_01_01">week 1 exercise</a> where we use <a href="https://www.dropbox.com/s/t0ml83xesaaazd0/hers_subset.csv?dl=1" target="_blank">hers_subset.csv</a> data to measure the association between diastolic blood pressure (DBP - the outcome) and body mass index (BMI - the exposure). The first plot shows the residual versus fitted plot. This shows an even scatter around zero with no fanning present for the majority of the plot. Towards the end of the plot, the residuals do seem to be a bit more negative than positive - but the sparsity of the data here makes this difficult to confirm. I would conclude here is no evidence against linearity or homoscedasticity and we can accept these assumptions as true. I would also like to see more data at higher fitted values levels to better confirm this. In the second plot, we see that the residuals are normally distributed as they follow a reasonably straight line on the normal quantile plot. Therefore we conclude the assumption of normality of residuals is true. Without further context of the study design that collected this data, we cannot draw any conclusions about the indepdence of observations - so we will assume this has been met. Therefore all the assumptions have been met and we conclude that a linear regression is appropriate for this data.</p>
<p>Stata code and output</p>
<div class="cell" data-collectcode="true">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> hers_subset</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> DBP BMI</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">rvfplot</span> <span class="co">/* the residual versus fitted plot */</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> res_std, residuals <span class="co">/* calculate the residuals*/</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qnorm</span> res_std <span class="co">/* The normal quantile plot of the residuals*/</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>##       Source |       SS           df       MS      Number <span class="kw">of</span> <span class="kw">obs</span>   =       276</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------   <span class="fu">F</span>(1, 274)       =      4.84</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>##        Model |  423.883938         1  423.883938   Prob &gt; <span class="fu">F</span>        =    0.0286</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>##     Residual |  23988.8842       274  87.5506722   R-squared       =    0.0174</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------   Adj R-squared   =    0.0138</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>##        Total |  24412.7681       275  88.7737022   Root MSE        =    9.3569</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>##          DBP | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>##          BMI |   .2221827   .1009756     2.20   0.029     .0233961    .4209693</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   67.82592   2.923282    23.20   0.000     62.07097    73.58087</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/Stata_resid.jpg" class="img-fluid" style="width:90.0%"></p>
<p>R code and output</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>hers_subset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://www.dropbox.com/s/t0ml83xesaaazd0/hers_subset.csv?dl=1"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>lm.hers <span class="ot">&lt;-</span> <span class="fu">lm</span>(DBP <span class="sc">~</span> BMI, <span class="at">data =</span> hers_subset)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.hers,<span class="dv">1</span>) <span class="co"># The residual versus fitted plot</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.hers,<span class="dv">2</span>) <span class="co"># The normal quantile plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="002-checking_assumptions_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Note that in R, you can also generate these plots manually by calling the “residuals” or “fitted” property in the “lm.hers” object. e.g.&nbsp;<code>plot(lm.hers$fitted, lm.hers$residuals)</code>. These properties can be helpful if you wish to use the residuals in other ways.</p>
</section>
<section id="transformations" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="transformations">Transformations</h2>
<p>Transformations are one of many possible remedies to deal with an assumption violation. They are particularly helpful when either the outcome, a covariate, or both are strongly right skewed - as is the case for many measurements in clinical and health research (e.g.&nbsp;length of hospital stay, survival times, and serum measurements). Although this skew isn’t of itself a problem (remember, the assumption is that the residuals are normally distributed, not the data itself), skewed data often results in violations to normality of residuals, homoscedasticity, and/or linearity. For example, consider the following plots.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="002-checking_assumptions_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can immediately see a number of problems that would deter us from fitting a linear regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(x\)</span>. First, there is no clear linear relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(x\)</span>. Secondly, the variability of the <span class="math inline">\(Y\)</span>-values increases with <span class="math inline">\(x\)</span>. Thirdly, the residuals of a linear regression are clearly non-normal, and heavily right-skewed. Indeed a histogram of <span class="math inline">\(Y\)</span> shows that the outcome is heavily right skewed.</p>
<section id="log-transformations-of-the-outcome" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="log-transformations-of-the-outcome">Log transformations of the outcome</h3>
<p>The scatter plot above is an example where the skew in the outcome (<span class="math inline">\(Y\)</span>) variable has caused problems in the linear regression. A common transformation to reduce skew is the <em>Log</em> transformation. Indeed log-transforming <span class="math inline">\(Y\)</span> eliminates this skew, and produces a scatter plot where linear regression would be appropriate, but this time with <span class="math inline">\(\text{log}(Y)\)</span> as the outcome variable.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="002-checking_assumptions_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The log transformation is a very natural tool for many biological measures because it converts multiplicative relationships (which characterise processes such as cell division and successive dilution of assays, for instance) into additive relationships - which by the central limit theorem are more likely to be normally distributed. For example on a logarithmic scale the values 0.1, 1 and 10 equals <span class="math inline">\(log(0.1) = -2.30\)</span>, <span class="math inline">\(log(1) = 0\)</span> and log(10) = 2.30 which are all equally spaced (with a difference of 2.3) as the original numbers (0.1, 1 and 10) all differ by a multiplicative factor of 10. Note that in this course “Log” is used to designate the natural logarithm. But logarithms to any base will work equally well as this corresponds simple to rescalling the logged values.</p>
<p>In the example above the variable <span class="math inline">\(Y\)</span> is said to have a <em>log-normal</em> distribution as it is normally distributed after taking a log transformation. i.e.&nbsp;<span class="math inline">\(\text{log}(Y) \sim N(\mu,\sigma^2)\)</span>. For log-normally distributed variables, the geometric mean as defined by <span class="math inline">\(GM(Y) = e^{\text{E}[log(Y)]} = e^{\mu}\)</span> is a more suitable summary statistic than the (arithmetic) mean we normally refer to. The geometric mean is also helpful for interpreting a linear regression when the outcome has been log-transformed as we see below.</p>
<p>The regression model is <span class="math inline">\(\log Y_i=\beta_0+\beta_1 x_i+\varepsilon_i\)</span>, where <span class="math inline">\(\varepsilon_i \sim N(0,\sigma^2)\)</span> and therefore <span class="math inline">\(\text{E}[\log Y_i]=\beta_0+\beta_i x_i\)</span>. Exponentiating both sides of the above, and recalling that GM<span class="math inline">\((Y)=e^{\text{E}[\log Y]}\)</span>, we can obtain an interpretation of the parameter <span class="math inline">\(\beta_1\)</span> in terms of the geometric mean of <span class="math inline">\(Y\)</span>.</p>
<p>Introducing the notation GM<span class="math inline">\((Y|x)\)</span> to denote the geometric mean of <span class="math inline">\(Y\)</span> at a given value of the covariate <span class="math inline">\(x\)</span>, we now examine the effect on GM<span class="math inline">\((Y|x)\)</span> for a change of 1 unit in <span class="math inline">\(x\)</span>: <span class="math display">\[\frac{\mbox{GM}(Y \mid x+1)}{\mbox{GM}(Y \mid x)}
  =\frac{e^{\text{E}[\log Y \mid x+1]}} {e^{\text{E}[\log Y \mid x]}}
  =\frac{e^{\beta_0+\beta_1(x+1)}} {e^{\beta_0+\beta_1x}}
  =\frac{e^{\beta_0} e^{\beta_1x} e^{\beta_1}} {e^{\beta_0} e^{\beta_1x}}
  =e^{\beta_1}.\]</span> Therefore increasing <span class="math inline">\(x\)</span> by 1 is associated with a <em>proportionate</em> (multiplicative) increase of <span class="math inline">\(e^{\beta_1}\)</span> in the geometric mean of <span class="math inline">\(Y\)</span>.</p>
</section>
<section id="log-transformations-of-the-outcome-and-covariates" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="log-transformations-of-the-outcome-and-covariates">Log transformations of the outcome and covariates</h3>
<p>Consider the following scatterplot of brain weight (in grams) versus body weight (in kg) for 62 different mammal species (Allison and Cicchetti, <em>Science</em>, 1976).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="002-checking_assumptions_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As almost all the data are bunched up in the bottom left hand corner. However, a logarithmic transformation of both brain and body weight reins in the extreme values on both axes and produce a scatterplot worth pursuing with linear regression.</p>
<p>The regression model that would be fitted is <span class="math inline">\(\log Y_i=\beta_0+\beta_1\log x_i+\varepsilon_i\)</span>. The parameter <span class="math inline">\(\beta_1\)</span> reflects the effect on <span class="math inline">\(\text{E}[\log Y\)</span>] of additive changes in <span class="math inline">\(\log(x)\)</span>, which correspond to multiplicative changes in <span class="math inline">\(x\)</span>. Therefore let us examine the proportionate change in GM(<span class="math inline">\(Y\)</span>) for a <em>doubling</em> of covariate <span class="math inline">\(x\)</span>.</p>
<p><span class="math display">\[\frac{\mbox{GM}(Y \mid 2x)}{\mbox{GM}(Y \mid x)}
  =\frac{e^{\text{E}[\log Y \mid 2x]}}{e^{\text{E}[\log Y \mid x]}}
  =\frac{e^{\beta_0+\beta_1\log(2x)}}{e^{\beta_0+\beta_1\log(x)}}
  = \frac{e^{\beta_0}(2x)^{\beta_1}}{e^{\beta_0}x^{\beta_1}}=2^{\beta_1}.\]</span></p>
<p>The estimated slope for this regression is 0.752, and so <span class="math inline">\(2^{0.752}\)</span> = 1.68. Therefore, we estimate the geometric mean brain weight to increase 1.68-fold or by 68% for each doubling in weight of mammals. The 95% confidence interval for <span class="math inline">\(2^{\beta_1}\)</span> is obtained from the 95% confidence interval for <span class="math inline">\(\beta_1\)</span> (say (L,U) ) by raising 2 to the power of the endpoints, namely (<span class="math inline">\(2^{L}, 2^{U}\)</span>), producing (1.62, 1.75) for this example.</p>
<p>This example is a rather extreme case with respect to the distribution of the covariate and it is probably fair to say that transformations of <span class="math inline">\(x\)</span> are not usually as important to consider as transformations of the outcome. Since the linear model takes the values of <span class="math inline">\(x\)</span> as given, so there is no modelling of their distribution, there is no formal need to obtain a “nice” symmetric distribution of the independent variable. However, when we discuss the concept of leverage in week 3 we will see that highly skewed <span class="math inline">\(x\)</span> distributions are undesirable because they may lead to just one or two observations having an unduly large influence on the estimated regression model.</p>
</section>
</section>
<section id="other-methods-for-handling-non-constant-variance" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="other-methods-for-handling-non-constant-variance">Other methods for handling non-constant variance</h2>
<!-- ### Delta method {.unnumbered} -->
<!--ARMANDO - I am not sure if this is helpful. The Delta method is obviously important but I don't how introducing an example of a Poisson count outcome would help with a linear regression.  I think this is more confusing than helpful -->
<!-- In situations where the variance of $Y$ varies with the mean $\mu$ -->
<!-- according to a known or observed approximate functional relationship -->
<!-- $\text{var}(Y)=f(\mu)$, we can use calculus to derive an appropriate -->
<!-- variance stabilising transformation. Specifically, we seek a -->
<!-- transformation $g$(.) such that Var($g(Y)$) is approximately constant -->
<!-- and not dependent on the mean $\mu$. To find $g$(.) we use a powerful -->
<!-- and important tool called the "Delta Method" that is very commonly used -->
<!-- to derive approximate standard errors for complex estimators. In fact, -->
<!-- it is simply a first order Taylor series expansion, as we shall now see. -->
<!-- A first order Taylor series expansion of $g(Y)$ about $Y=\mu$ yields -->
<!-- $$g(Y)=g(\mu)+g'(\mu)(Y-\mu),$$ where -->
<!-- $\displaystyle g'(\mu)=\frac{dg(Y)}{dY}$ evaluated at $Y=\mu$. -->
<!-- Therefore, since $g(\mu)$ is constant, to a first order approximation, -->
<!-- $$\text{var}[g(Y)]=g'(\mu)^2\text{E}(Y-\mu)^2=g'(\mu)^2\text{var}(Y)=g'(\mu)^2f(\mu).$$ -->
<!-- So for $\text{var}[g(Y)]$ to be constant we need to seek a function -->
<!-- $g(\cdot)$ satisfying -->
<!-- $$\frac{dg(z)}{dz}\propto \frac{1}{\sqrt{f(z)}} \;\;\mbox{, that is, } -->
<!-- g(z)=\int \frac{1}{\sqrt{f(z)}}dz.$$ For example, with Poisson counts -->
<!-- with mean $\mu$, Var($Y)=f(\mu)=\mu$, so -->
<!-- $g(z)=\int \frac{1}{\sqrt{z}}dz=\sqrt{z}$, and therefore a square root -->
<!-- transformation of $Y$ is appropriate. -->
<section id="weighted-least-squares" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="weighted-least-squares">Weighted least squares</h3>
<p>Weighted least squares is an alternative linear regression fitting algorithm to ordinary least squares which is suitable when the variance is non-constant. Here, instead of minimising the sum of square error <span class="math display">\[ \sum(Y_i - \bar{Y}_i)^2\]</span> we instead minimise the weighted sum of square error <span class="math display">\[ \sum w_i(Y_i - \bar{Y}_i)^2\]</span> where <span class="math inline">\(w_i = \frac{1}{\text{var}(Y_i)}\)</span>. That is, the error for each observation is scaled by it’s predicted variance. When the predicted variance is unknown iterative procedures exist to progressively improve homoscedasticity in weighted linear regression.</p>
</section>
</section>
<section id="collaborative-exercise" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="collaborative-exercise">Collaborative exercise</h2>
<p><a href="https://www.dropbox.com/s/qgoekz6ol2vnpw6/assumptions.csv?dl=1" target="_blank">assumptions.csv</a> consists of simulated data for you to practice checking the assumptions of simple linear regression. It contains 4 continuous outcome variables <code>y1</code>, <code>y2</code>, <code>y3</code> and <code>y4</code>. It has two explanatory variables <code>x1</code> and <code>x2</code>. Your task is to investigate the assumptions of any or all of the possible different simple linear regressions between the outcome variables and the explanatory variables. There are 8 possible regressions to check in total (4 choices for outcome variable, and 2 choices for explanatory variable. <span class="math inline">\(4\times2=8\)</span>). You can either investigate all 8, or however many you have time for - but the more practice the better!</p>
<p>Discuss your analysis of the assumptions with your group in a self organised zoom meeting, or on your groups dedicated discussion board. If you need help with setting up a zoom meeting, please contact the unit coordinator for assistance.</p>
</section>
<section id="summary" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="summary">Summary</h2>
<div class="callout callout-style-default callout-note callout-titled" title="This week’s key concepts are:">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This week’s key concepts are:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Linear regression has four key assumptions that should be investigated:
<ul>
<li>Linearity - investigated with a residual versus fitted plot. An even scatter around zero indicates this assumption has been met</li>
<li>Homoscedasticity (constant variance) - investigated with a residual versus fitted plot. An even scatter around zero with no “fanning” indicates this assumption has been met</li>
<li>Normality of residuals - investigated with a normal quantile plot, or a histogram, of the residuals. For large sample sizes, moderate deviations to this assumption are ok.</li>
<li>Independence of observations. This is usually investigated by reviewing the study design. However sometimes there can be warning flags present in the data (e.g.&nbsp;a participant identifier column with duplicate entries).</li>
</ul></li>
<li>Violations of any of the assumptions above will result in regression results that are biased, have incorrect interpretations, or have inflated type 1 errors. The greater the violation to the assumption, the greater the consequence</li>
<li>Log transformations are a useful tool that can often improve assumption violations. However, the interpretation of regression coefficients will change with a log transformation.</li>
</ul>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./001-simple_linear_regression.html" class="pagination-link" aria-label="Simple Linear Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./003-binary_covariates_and_outliers.html" class="pagination-link" aria-label="Binary Covariates, Outliers, and Influential Observations">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Binary Covariates, Outliers, and Influential Observations</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Regression Modeling for Biostatistics.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>