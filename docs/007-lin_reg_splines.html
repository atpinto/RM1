<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regression Modelling for Biostatistics 1 - 7&nbsp; Violations of assumptions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./008-model_building.html" rel="next">
<link href="./006-interaction_collinearity.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./007-lin_reg_splines.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Violations of assumptions</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/bca.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression Modelling for Biostatistics 1</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001-simple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002-checking_assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Checking Assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./003-binary_covariates_and_outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Binary Covariates, Outliers, and Influential Observations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./004-multiple_linear_regression_application.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Multiple Linear Regression - Application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005-lin_reg_theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple linear regression theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006-interaction_collinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Interaction and Collinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./007-lin_reg_splines.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Violations of assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./008-model_building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regression model building and variable selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./009-logistic_regression_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-logistic_regression_conf_inter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011-logistic_regression_splines_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012-logistic_regression_model_building.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">model building for binary outcomes</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learn_obj_wk07" id="toc-learn_obj_wk07" class="nav-link active" data-scroll-target="#learn_obj_wk07">Learning objectives</a></li>
  <li><a href="#learn_act_wk07" id="toc-learn_act_wk07" class="nav-link" data-scroll-target="#learn_act_wk07">Learning activities</a></li>
  <li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression">Polynomial regression</a></li>
  <li><a href="#restricted-cubic-splines" id="toc-restricted-cubic-splines" class="nav-link" data-scroll-target="#restricted-cubic-splines">Restricted cubic splines</a>
  <ul class="collapse">
  <li><a href="#syntax-and-outputs" id="toc-syntax-and-outputs" class="nav-link" data-scroll-target="#syntax-and-outputs">Syntax and outputs</a></li>
  <li><a href="#choosing-the-knots-and-their-number" id="toc-choosing-the-knots-and-their-number" class="nav-link" data-scroll-target="#choosing-the-knots-and-their-number">Choosing the knots and their number</a></li>
  <li><a href="#do-we-need-the-splines-which-fit-should-we-choose" id="toc-do-we-need-the-splines-which-fit-should-we-choose" class="nav-link" data-scroll-target="#do-we-need-the-splines-which-fit-should-we-choose">Do we need the splines? Which fit should we choose?</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#investigation" id="toc-investigation" class="nav-link" data-scroll-target="#investigation">Investigation</a></li>
  </ul></li>
  <li><a href="#fractional-polynomials-and-other-methods" id="toc-fractional-polynomials-and-other-methods" class="nav-link" data-scroll-target="#fractional-polynomials-and-other-methods">Fractional polynomials and other methods</a></li>
  <li><a href="#other-issues" id="toc-other-issues" class="nav-link" data-scroll-target="#other-issues">Other issues</a>
  <ul class="collapse">
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping">Bootstrapping</a></li>
  <li><a href="#bootstrap-investigation" id="toc-bootstrap-investigation" class="nav-link" data-scroll-target="#bootstrap-investigation">Bootstrap investigation</a></li>
  <li><a href="#heteroscedasticity" id="toc-heteroscedasticity" class="nav-link" data-scroll-target="#heteroscedasticity">Heteroscedasticity</a></li>
  </ul></li>
  <li><a href="#summary_wk11" id="toc-summary_wk11" class="nav-link" data-scroll-target="#summary_wk11">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="linreg_splines" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Violations of assumptions</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="learn_obj_wk07" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learn_obj_wk07">Learning objectives</h2>
<p>By the end of this week you should:</p>
<ol type="1">
<li><p>Be able to run polynomial regression</p></li>
<li><p>Know about restricted cubic splines and how they can model nonlinearities</p></li>
<li><p>Have a general understanding of the use of flexible techniques to evaluate the shape of a regression function</p></li>
<li><p>Be familar with the bootstrap and its use in linear regression</p></li>
<li><p>Understand how heteroscedasticity can be handled in practice</p></li>
</ol>
</section>
<section id="learn_act_wk07" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learn_act_wk07">Learning activities</h2>
<p>This week’s learning activities include:</p>
<table class="table">
<thead>
<tr class="header">
<th>Learning Activity</th>
<th>Learning objectives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lecture 1</td>
<td>1, 2, 3</td>
</tr>
<tr class="even">
<td>Reading</td>
<td>4</td>
</tr>
<tr class="odd">
<td>Lecture 2</td>
<td>4, 5</td>
</tr>
<tr class="even">
<td>Investigations</td>
<td>2, 4</td>
</tr>
</tbody>
</table>
<p><strong>Lecture 1 in R</strong></p>
<iframe width="740" height="416" src="https://www.youtube.com/embed/b1Vm9Mg3GyM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p><a href="https://www.dropbox.com/s/9pkw9yphe4aj7ma/RM1_week7_lecture1_R.mp4?dl=1">Download video here</a></p>
<p><strong>Lecture 1 in Stata</strong></p>
<iframe width="740" height="416" src="https://www.youtube.com/embed/oSib7b4FtP0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p><a href="https://www.dropbox.com/s/poiu22qxad1sh4n/RM1_week7_lecture1_Stata.mp4?dl=1">Download video here</a></p>
<p>We have seen how to use residuals to identify non-linearities, this week we will first revisit the issue and introduce new modelling techniques to deal with nonlinear associations.</p>
<!-- triceps data for this section  -->
</section>
<section id="polynomial-regression" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="polynomial-regression">Polynomial regression</h2>
<!-- notation + cubic polynomial + figure (lowess + cubic) -->
<p>To motivate, we consider data on 892 females under 50 years collected in three villages in West Africa. Investigators are interested in exploring the relationship between age and triceps skinfold thickness, a crude measure of body fat. The dataset is called <em>triceps</em> and include <em>age</em>, <em>thick</em> and <em>logthick</em>, for respectively age in years, triceps skinfold thickness in mm and its logarithm. The figure below displays the the relationship between <em>age</em> and <em>logthick</em> and it is immediately clear that this relationship in nonlinear on such a wide age span. A nonparametric smoother (LOWESS) can be applied to the data and returns the blue fitted line confirming the visual impression.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in file(file, "rt"): cannot open URL
'https://www.dropbox.com/s/dl/5yk6u248adycvq1/triceps.csv': HTTP status was
'400 Bad Request'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in file(file, "rt"): cannot open the connection to 'https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(m$data, eframe): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(x[[2L]], environment(x)): object 'triceps' not found</code></pre>
</div>
</div>
<p>A simple regression model of the form <span class="math inline">\(logthick_i=\beta_0+\beta_1 age_i+\epsilon_i\)</span> for <span class="math inline">\(i=1,\dots,n=892\)</span> would hardly give an approximation of the observed pattern, so the question arises: how can we modify it to make it more realistic? The first strategy is to replace the linear function of age by a cubic polynomial: <span class="math inline">\(f(age)=\beta_0+\beta_1 age +\beta_2 age^2 + \beta_2 age^3\)</span>. The term ``cubic’’ is used because we are fitting a polynomial of degree 3 due to the largest exponent being 3. A quadratic curve could also be fitted but would not be appropriate given the shape of the plot. Such a model is naturally called polynomial regression, irrespective of the degree of the polynomial function <span class="math inline">\(f(x)\)</span>. Although we can define by hand the quadratic and cubic terms it’s preferable to use the built-in tool <em>poly(x,3)</em> in R to define the polynomial (here <span class="math inline">\(x\)</span> refers to the variable of interest, e.g.&nbsp;<span class="math inline">\(x=age\)</span>). This leads to a simpler univariate smooth model of the form: <span class="math inline">\(y_i=f(x_i)+\epsilon_i\)</span> where <span class="math inline">\(y\)</span> is the generic term for the response (<span class="math inline">\(y=logthick\)</span> in our example).</p>
<p>The following fit is now obtained and there is clearly some improvement over a linear fit but we may be left with the visual impression that fitting a cubic polynomial is not quite enough to capture the structure of the data, especially around year 10 where the fit does not seem so good.</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(m$data, eframe): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(mf, parent.frame()): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(mf, parent.frame()): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
</div>
<p>Although all polynomial coefficients are significant - results not shown -, we should <em>not</em> use significance to decide to include a particular term or not. Another parametrisation based on orthogonal polynomials is often preferable as it is more stable, especially for high-degree polynomials. Using this parametrisation which is the default parametrisation in R yields a non-significant quadratic term. It is nevertheless needed to give the same fit. The F-test (or a LRT test) can help decide whether the cubic polynomial in age is necessary and is, for instance, better than a quadratic polynomial or a simple linear fit. We leave this as an exercise.</p>
<p>The R code for this section and a slightly simpler version for Stata are given below:</p>
<p>R Code</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in file(file, "rt"): cannot open URL
'https://www.dropbox.com/s/dl/5yk6u248adycvq1/triceps.csv': HTTP status was
'400 Bad Request'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in file(file, "rt"): cannot open the connection to 'https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(m$data, eframe): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(x[[2L]], environment(x)): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(m$data, eframe): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(mf, parent.frame()): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(mf, parent.frame()): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
</div>
<p>Stata code and output</p>
<div class="cell" data-collectcode="true">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>import delimited <span class="st">"https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1"</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> age2 = age^2</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> age3 = age^3</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> logthick age age2 age3</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>quiet <span class="kw">predict</span> pred</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span>  <span class="kw">scatter</span> logthick age || <span class="kw">line</span> pred age, <span class="kw">sort</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">test</span> age2 age3  </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>## <span class="kw">compare</span> cubic polynomial <span class="kw">fit</span> to linear <span class="kw">fit</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>## server refused to send file</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>## could <span class="kw">not</span> open url</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="restricted-cubic-splines" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="restricted-cubic-splines">Restricted cubic splines</h2>
<p>The disadvantage of polynomials is that they tend to fit the data globally and are not very good locally, for instance around year 10 for <em>logthick</em>. One way to get around this issue is to partition the range of <span class="math inline">\(age\)</span> (or the covariate <span class="math inline">\(x\)</span> in general) into smaller intervals, utilising a small number of points called <em>knots</em>. We can then fit (cubic) polynomials locally but by doing this we will get discontinuities. A simple remedy is to impose constraints on these polynomials so that the global result is a <em>smooth</em> function. We typically do this by forcing the successive derivatives of the function to be continuous up to some order (e.g.&nbsp;2). The resulting function is called a spline. Different splines exist and a common type consists of portions of cubic polynomials in the middle joined together at the knots that become linear in the edges (i.e before the first knot and after the last one). Such splines are called Restricted Cubic Splines (RCS) with RCS(4) denoting a RCS with 4 knots. Restrictions are imposed to the different parts to yield a smooth function. It is not necessary to know their complex algebraic expression but we can see how the look on Figure 7.1 below:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE, : there is no package called 'rms'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in rcspline.eval(age.grid, knots = kk, nk = 5, inclx = TRUE): could not find function "rcspline.eval"</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'tt' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'tt' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'tt' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'tt' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in ols(logthick ~ rcs(age, kk), data = triceps): could not find function "ols"</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'fit.rcs' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'pred.rcs' not found</code></pre>
</div>
</div>
<p>** Figure 7.1:** Spline basis functions and fitted line</p>
<p>There are 4 terms because we choose 5 knots (i.e, d.f. = number of knots minus 1) noted <span class="math inline">\(S_1(age)=age\)</span> in blue, <span class="math inline">\(S_2(age)\)</span> in red, <span class="math inline">\(S_3(age)\)</span> in magenta, <span class="math inline">\(S_4(age)\)</span> in green on the left panel. Each individual spline function (called spline basis) should not be interpreted individually. What matters is their ``combined effect”, i.e the function <span class="math inline">\(f(age)=b_0 + b_1S_1(age)+b_2S_2(age)+b_3S_3(age)+b_4S_4(age)\)</span> which is very smooth and seems to capture well the features of the data. Here the coefficients <span class="math inline">\(b_0,b_1,\dots,b_4\)</span> where calculated by fitting <span class="math inline">\(f(a)\)</span> to the data. Such a fit is possible using standard commands since the function <em>linear in the coefficients</em> despite its <em>nonlinearity in age</em>.</p>
<section id="syntax-and-outputs" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="syntax-and-outputs">Syntax and outputs</h3>
<p>This is how you can fit such a model in R. This requires a slightly different syntax from what you have been using so far. R makes use of the <em>rms</em> library and the command <em>ols</em> instead of <em>lm</em>. The spline function itself is specified by adding <em>rcs</em> within the formula yielding:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE, : there is no package called 'rms'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ddist <span class="ot">&lt;-</span> <span class="fu">datadist</span>(triceps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in datadist(triceps): could not find function "datadist"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist=</span><span class="st">'ddist'</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fit.rcs <span class="ot">&lt;-</span> <span class="fu">ols</span>(logthick <span class="sc">~</span> <span class="fu">rcs</span>(age,<span class="dv">4</span>),<span class="at">data=</span>triceps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in ols(logthick ~ rcs(age, 4), data = triceps): could not find function "ols"</code></pre>
</div>
</div>
<p>The command <em>rcs(age,4)</em> specifies a RCS in age with 4 knots placed at their default location. Note that the first two lines after calling the <em>rms</em> library are not absolutely needed to get the fit but there will be used to plot the splines, so it’s recommended to add them anyway. The output is given below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fit.rcs</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'fit.rcs' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You may notice that the syntax is slightly different from the standard way to display an output after typing the <em>lm</em> command since <em>summary()</em> is not used. The display is rather unsual and indicates the coefficients for the various spline bases with the notation <span class="math inline">\(age^\prime\)</span> and <span class="math inline">\(age^{\prime\prime}\)</span> corresponding to two additional splines terms <span class="math inline">\(S_2(a)\)</span> and <span class="math inline">\(S_3(a)\)</span> that are never interpreted separarely.</p>
<p>The Stata syntax still uses the usual <em>regress</em> command but it’s preceeded by a command <em>mkspline</em> explaining what splines need to be fitted. Below the syntax and output in Stata.</p>
<p>Stata code and output</p>
<div class="cell" data-collectcode="true">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>import delimited <span class="st">"https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1"</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mkspline</span> age_spl = age, cubic nknots(4)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> logthick  age_spl* </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>## server refused to send file</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>## could <span class="kw">not</span> open url</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The command <em>mkspline age_spl = age, cubic nknots(4)</em> asks Stata to create a RCS in age with 4 knots, Stata will generate the correspponding terms called <em>age_spl1</em>, <em>age_spl2</em> and <em>age_spl3</em>. Note that <em>age_spl1</em> is always <em>age</em> so that the syntax is equivalent to <em>regress logthick age age_spl1 age_spl2</em>. The generic command with * makes sure that <em>all</em> terms are included. Some other options are available that you can explore using the help.</p>
<p>What remained to be discussed is: 1) how do we choose the knots?; 2) how many knots do we choose?; and possibly 3) how do we know that the splines are needed?</p>
</section>
<section id="choosing-the-knots-and-their-number" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="choosing-the-knots-and-their-number">Choosing the knots and their number</h3>
<p>Typically a small number of knots is recommended, say between 3 and 5. We chose 5 knots earlier because we have a lot of data but 4 is ofen appropriate. Their location is critical and up to the investigator. A default choice have been fortunately implemented in Stata and R at specific quantiles of the variable of interest. The two figures below gives you the data and 2 different fits, one with 4 knots located using the default (Figure 7.2) and at age 10, 20, 35, 45 (Figure 7.3). We added the vertical dotted lines to indicate their location.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE, : there is no package called 'rms'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in datadist(triceps): could not find function "datadist"</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in ols(logthick ~ rcs(age, 4), data = triceps): could not find function "ols"</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'fit.rcs4a' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(m$data, eframe): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
</div>
<p>** Figure 7.2:** A RCS spline fit with 4 knots (default location)</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE, : there is no package called 'rms'</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in datadist(triceps): could not find function "datadist"</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in ols(logthick ~ rcs(age, c(10, 20, 35, 45)), data = triceps): could not find function "ols"</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'fit.rcs4b' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(m$data, eframe): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'triceps' not found</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new has not been called yet</code></pre>
</div>
</div>
<p>** Figure 7.3:** A RCS spline fit with 4 knots at age 10, 20, 35 and 45.</p>
<p>We clearly see that the default choice (Figure 7.2) gives a better fit visually than the manual choice with knots at 10, 20, 35, 45 (Figure 7.3), the first two knots being too high. By default, the knots in Figure 7.2 are chosen at the <span class="math inline">\(.05^{th}\)</span>, <span class="math inline">\(.35^{th}\)</span>, <span class="math inline">\(.65^{th}\)</span> and $.95^{th} quantiles of <em>age</em>, e.g the first knot is at age 1.2775 (!), the second at 8.1955. Note in Figure 7.3 that the function is indeed linear for extreme age values (blue dotted line). This is also the case for Figure 7.2 but it’s less apparent on the plot.</p>
</section>
<section id="do-we-need-the-splines-which-fit-should-we-choose" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="do-we-need-the-splines-which-fit-should-we-choose">Do we need the splines? Which fit should we choose?</h3>
<p>Because the first spline basis is always the variable of interest (here <em>age</em>) we can use a F-test to test whether the added terms are needed. This is typically carried out in R using the <em>anova</em> command following the fit obtained previously. The F-test concludes that the additional terms are indeed needed with either the default choice of knots or the one chosen by the investigator (p&lt; 0.0001).</p>
<p>The R and Stata code to fit splines with explanation is below.</p>
<p><strong>R Code</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 7.2</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the data by increasing age</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>triceps<span class="ot">&lt;-</span>triceps[<span class="fu">order</span>(triceps<span class="sc">$</span>age),]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># top panel: default</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>ddist <span class="ot">&lt;-</span> <span class="fu">datadist</span>(triceps)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in datadist(triceps): could not find function "datadist"</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist=</span><span class="st">'ddist'</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>fit.rcs4a <span class="ot">&lt;-</span> <span class="fu">ols</span>(logthick <span class="sc">~</span> <span class="fu">rcs</span>(age,<span class="dv">4</span>),<span class="at">data=</span>triceps)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in ols(logthick ~ rcs(age, 4), data = triceps): could not find function "ols"</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>pred4a<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.rcs4a)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'fit.rcs4a' not found</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logthick<span class="sc">~</span>age, <span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"Skinfold thickness (log)"</span>, <span class="at">data=</span>triceps)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(m$data, eframe): object 'triceps' not found</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(triceps<span class="sc">$</span>age,pred4a,  <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(triceps<span class="sc">$</span>age,<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.35</span>,<span class="fl">0.65</span>,<span class="fl">0.95</span>)),<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing whether the additional splines terms are necessary</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit.rcs4a)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'fit.rcs4a' not found</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="co"># look at age nonlinear with 2 df. Highly significant. Splines necessary</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 7.3</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>fit.rcs4b <span class="ot">&lt;-</span> <span class="fu">ols</span>(logthick <span class="sc">~</span> <span class="fu">rcs</span>(age,<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">35</span>,<span class="dv">45</span>)),<span class="at">data=</span>triceps)</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in ols(logthick ~ rcs(age, c(10, 20, 35, 45)), data = triceps): could not find function "ols"</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>pred4b<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.rcs4b)</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'fit.rcs4b' not found</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logthick<span class="sc">~</span>age, <span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"Skinfold thickness (log)"</span>,<span class="at">data=</span>triceps)</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(m$data, eframe): object 'triceps' not found</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(triceps<span class="sc">$</span>age,pred4b,  <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">35</span>,<span class="dv">45</span>),<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new has not been called yet</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>mini<span class="ot">&lt;-</span><span class="fu">max</span>(<span class="fu">which</span>(triceps<span class="sc">$</span>age <span class="sc">&lt;</span><span class="dv">10</span>))</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>maxi<span class="ot">&lt;-</span><span class="fu">min</span>(<span class="fu">which</span>(triceps<span class="sc">$</span>age <span class="sc">&gt;=</span><span class="dv">45</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(triceps<span class="sc">$</span>age[mini<span class="sc">:</span>maxi],pred4b[mini<span class="sc">:</span>maxi],  <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">1</span>)</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="co"># poor fit for lower age</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure without fancy colours, do not run the last 3 lines</span></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing whether the additional splines terms are necessary</span></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit.rcs4b)</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'fit.rcs4b' not found</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a><span class="co"># look at age nonlinear with 2 df. Highly significant. Splines necessary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Indications on how to produce a simpler figure in R were also provided. We don’t suggest you produce complex figures like this one. Even the vertical lines displaying the knots location are often omitted.</p>
<p><strong>Stata code and output</strong></p>
<div class="cell" data-collectcode="true">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>## Figure 7.2, <span class="kw">default</span> knots, and <span class="kw">fit</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>import delimited <span class="st">"https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1"</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mkspline</span> age_spl = age, cubic nknots(4) displayknots</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> logthick  age_spl*</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> pred</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> <span class="kw">scatter</span> logthick age, <span class="bn">xline</span>(1.243  8.1865  17.469 42.72) || <span class="kw">line</span> pred age, <span class="kw">sort</span> clstyle(solid) </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a># Testing whether the additional splines terms are necessary</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="kw">test</span> age_spl2 age_spl3</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>## Figure 7.3, knots <span class="fu">at</span> 10, 20, 35 and 45, and <span class="kw">fit</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> pred age_spl*</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="kw">mkspline</span> age_spl = age, cubic knots(10 20 35 45)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> <span class="fu">r</span>(knots)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> logthick  age_spl*</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> pred</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> <span class="kw">scatter</span> logthick age, <span class="bn">xline</span>(10 20 35 45) || <span class="kw">line</span> pred age, <span class="kw">sort</span> clstyle(solid) </span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a># Testing whether the additional splines terms are necessary</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="kw">test</span> age_spl2 age_spl3</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>## server refused to send file</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>## could <span class="kw">not</span> open url</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have produced 3 different fits of the same data (ignoring the RCS(5) fit given to show what a spline function is): a) cubic polynomial; b) RCs(4), default knots; c) RCS(4), knots at age 10, 20 35, 45. Visually, it’s clearly that b) gives the better fit, so this is the one we’ll choose. There are many other fits you could get by playing with the number of knots and their location, so you could add them to the list. There is a way to compare such models that are not nested, we defer the explanation to week 8 but hopefully the approach agrees with the visual impression.</p>
</section>
<section id="interpretation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretation">Interpretation</h3>
<p>There are several ways you can interpret the results after fitting a spline model to the data and concluding that splines are indeed necessary. Let’s for instance consider the RCS(4) model used for the triceps data. The simplest (and possibly most common) way is to display a plot like Figure 7.2 or only the spline function with its 95% CI and interpret it <em>qualitatively</em>. Here log-thickness decreases with age until the age of 8-9 and starts to increase again to reach a maximum slighlty above 2.5 around 30-35. From then on, it does not change much with a very slow reduction as women get older (up to the maximum age in the data, i.e.&nbsp;52).</p>
<p>The second way is to try to quantify the relationship. One might wonder what the average change in log-thickness per each additional year of age is? The problem is more complicated than usual as we have fitted a function of age, <span class="math inline">\(f(age)=b_0+b_1age+b_2S_2(age)+b_3S_3(age)\)</span>. Any increment of age will also affect the spline functions <span class="math inline">\(S_2(age)\)</span> and <span class="math inline">\(S_3(age)\)</span> so we can not interpet each coefficient separately. However, the same principle applies and, at least theoretially, we can compute the marginal change in log-thickness associated with a i year increment. To make things simpler, let’s choose a particular age, say 10. What we need to do is compute the (expected) change in log-thickness for a change in age from 10 to 11. This amounts to computing the difference: <span class="math inline">\(d=f(11)-f(10)=b_1+b_2[S_2(11)-S_2(10)]+b_3[S_3(11)-S_3(10)]\)</span>. This is a <em>linear</em> combination of the model coefficients <span class="math inline">\(b_1\)</span>, <span class="math inline">\(b_2\)</span>, <span class="math inline">\(b_3\)</span> so in principle we should be able to estimate this but the difficulty is to get the ``weights” <span class="math inline">\(w_2=S_2(11)-S_2(10)\)</span> and <span class="math inline">\(w_3=S_3(11)-S_3(10)\)</span> that involve the spline basis functions. The weight of age in <span class="math inline">\(f(age)\)</span> is always one here by construction.</p>
<p>OPTIONAL: Regarding this calculation, Stata users have the edge since the software provides an approximation through the derivative since <span class="math inline">\(f(11)-f(10)\simeq f'(10)\)</span>. In general, <span class="math inline">\(f(a+1)-f(age))\simeq f'(a)\)</span> thanks to a Taylor expansion. The R users don’t have this luxury and have to work out for themselves what this difference is. For that reason, what follows is considered optional but Stata users should not have any problem to run the few lines of code that are needed. Note that the splines have to be generated using the command <em>mkspline2</em> command instead of <em>mkspline</em>. This command and the one that computes the derivative are available once a user-defined code has been installed (type: <em>ssc install postrcspline</em>).</p>
<p><strong>Stata code</strong></p>
<div class="cell" data-collectcode="true">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>import delimited <span class="st">"https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1"</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>mkspline2 age_spl = age, cubic nknots(4)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> logthick  age_spl*</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>mfxrcspline, <span class="kw">gen</span>(delta <span class="fu">lower</span> <span class="fu">upper</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> age</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>## --------------------------------------------------</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>## <span class="kw">this</span> additional command allows you to browse (only) </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>## the <span class="kw">new</span> variables created. Deactivated here.</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>## You can also browse the <span class="kw">data</span> manually</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>## ---------------------------------</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>## br age delta <span class="fu">lower</span> <span class="fu">upper</span> </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>## server refused to send file</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>## could <span class="kw">not</span> open url</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>## <span class="fu">r</span>(603);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code plots the derivative as a function of age and produces the marginal difference per additional year of age for each datapoint in the triceps dataset. The last two lines allow us to sort the data and list all the differenes (variable <em>delta</em> and <em>lower</em> and <em>upper</em> for the 95% CI). If we look at what was produced, we can see that for a women aged 10, the average change in log-thickness for a 1-year change in age is: 0.026, 95% CI=0.022 ; 0.0299). We choose 10 since it is an age that we have in the dataset to make things simpler. This can be obtained by looking at the results (type<em>br age delta lower upper</em> to see all differences). We typically talk about the rate of change in log-thickness associated with age. Had we chosen age=27, we would have obtained: 0.017, 95%CI=(0.0144 ; 0.0194). Of course, when age is beyond the last knot (i.e.&nbsp;42.7 years) or prior to the first knot, the rate of change become constant since by definition the RCS is linear in the tails.</p>
<p>R-users have to work a lot harder to get something similar. The code below explains how it’s done and give you some explanation. Results may be sligthly different since we are not approximating the difference here. An <em>optional</em> video is available so maybe R-users can watch this video first.</p>
<p>Lecture 1b in R [OPTIONAL - help with an interpretation that is not directly provided in R]</p>
<iframe width="740" height="416" src="https://www.youtube.com/embed/iNep-W5SoOA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p><a href="https://canvas.sydney.edu.au/files/23346714/download?download_frd=1">Download video here</a></p>
<p><strong>R code</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>triceps<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in file(file, "rt"): cannot open URL</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 'https://www.dropbox.com/s/dl/5yk6u248adycvq1/triceps.csv': HTTP status was</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="do">## '400 Bad Request'</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in file(file, "rt"): cannot open the connection to 'https://www.dropbox.com/s/5yk6u248adycvq1/triceps.csv?dl=1'</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>triceps<span class="ot">&lt;-</span><span class="fu">data.frame</span>(triceps)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>triceps <span class="ot">&lt;-</span> triceps[<span class="fu">order</span>(triceps<span class="sc">$</span>age),] </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'triceps' not found</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fit RCS(4) to the data</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rms)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: rms</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in library(package, lib.loc = lib.loc, character.only = TRUE,</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="do">## logical.return = TRUE, : there is no package called 'rms'</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>ddist <span class="ot">&lt;-</span> <span class="fu">datadist</span>(triceps)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in datadist(triceps): could not find function "datadist"</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist=</span><span class="st">'ddist'</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>fit.rcs4 <span class="ot">&lt;-</span> <span class="fu">ols</span>(logthick <span class="sc">~</span> <span class="fu">rcs</span>(age,<span class="dv">4</span>),<span class="at">data=</span>triceps)</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in ols(logthick ~ rcs(age, 4), data = triceps): could not find function "ols"</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>                                                         <span class="co"># Comment</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>                                                         <span class="co"># -------</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>age.val<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">10</span>)                                           <span class="co"># Choose a particular age, here 10</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>kk<span class="ot">=</span><span class="fu">attributes</span>(<span class="fu">rcs</span>(triceps<span class="sc">$</span>age,<span class="dv">4</span>))<span class="sc">$</span>parms                  <span class="co"># get the knots</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in rcs(triceps$age, 4): could not find function "rcs"</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>tt<span class="ot">&lt;-</span><span class="fu">rcspline.eval</span>(age.val,<span class="at">knots=</span>kk,<span class="at">nk=</span><span class="dv">4</span>,<span class="at">inclx=</span><span class="cn">TRUE</span>)      <span class="co"># evaluate the spline functions at age=10</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in rcspline.eval(age.val, knots = kk, nk = 4, inclx = TRUE): could not find function "rcspline.eval"</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>tt1<span class="ot">&lt;-</span><span class="fu">rcspline.eval</span>(age.val<span class="sc">+</span><span class="dv">1</span>,<span class="at">knots=</span>kk,<span class="at">nk=</span><span class="dv">4</span>,<span class="at">inclx=</span><span class="cn">TRUE</span>)   <span class="co"># evaluate the spline functions at age=11 (add 1)</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in rcspline.eval(age.val + 1, knots = kk, nk = 4, inclx = TRUE): could not find function "rcspline.eval"</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>diff<span class="ot">=</span>tt1<span class="sc">-</span>tt                                              <span class="co"># compute the differences</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'tt1' not found</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(diff)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="do">## function (x, ...) </span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="do">## UseMethod("diff")</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;bytecode: 0x138cb1630&gt;</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;environment: namespace:base&gt;</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="co"># these are the "weights"  you need to use in lincom or glht </span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a><span class="co"># for coefficients beta1, beta2, beta3 (all splines terms)</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="co"># what I called w_1=1, w_2 and w_3. Note that w_1=1 because the</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="co"># first basis function is age, with the two others used to</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="co"># model non-linearities. In their absence we would go</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a><span class="co"># back to the usual interpretation and therefore w1=1 </span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a><span class="co"># is expected.</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(multcomp)</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: multcomp</span></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: mvtnorm</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: survival</span></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: TH.data</span></span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: MASS</span></span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Attaching package: 'TH.data'</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="do">## The following object is masked from 'package:MASS':</span></span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="do">##     geyser</span></span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="st">"test marginal effect at that age"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>,diff)) </span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a>              <span class="co"># the leading 0 is for the intercept coeff (unused)</span></span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a>lincom<span class="ot">&lt;-</span><span class="fu">glht</span>(fit.rcs4, <span class="at">linfct=</span>test)</span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'fit.rcs4' not found</span></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lincom)</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'lincom' not found</span></span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a><span class="co"># you can then get the 95% CI "by hand"</span></span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a>lower<span class="ot">=</span><span class="fl">0.032036-1.96</span><span class="sc">*</span><span class="fl">0.002092</span></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a>upper<span class="ot">=</span><span class="fl">0.032036+1.96</span><span class="sc">*</span><span class="fl">0.002092</span></span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lower,upper)</span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.02793568 0.03613632</span></span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="co">#  95% CI=( 0.02793568 ; 0.03613632)</span></span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="co"># slightly different results in R (no approximation)</span></span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a><span class="co"># you can repeat the process by choosing another age value (e.g. 27) but make sure your</span></span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a><span class="co"># update the manual calculation of the 95% CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="investigation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="investigation">Investigation</h3>
<p>The objective of this activity is to become familiar with RCS using the <em>hers</em> data</p>
<ol type="1">
<li><p>Start by reading p.&nbsp;113 - 114 of Vittinghof et al.&nbsp;(2012) where the authors model <em>HDL</em> as RCS of <em>BMI</em> adjusted for a few covariates, namely <em>age</em>, <em>nonwhite</em>, <em>smoking</em> and <em>drinkany</em> and fit a simple model with these covariates. We suspect the association with BMI may not be linear (see Table 4.20, p.&nbsp;111 for more)</p></li>
<li><p>Fit a RCS in BMI with 4 knots while adjusting for the other covariates. Does it change the conclusion regarding the linearity of BMI? Test whether the additional spline terms in BMI are necessary for this data? Note that if you want to reproduce the results of Table 4.21 p.&nbsp;114, you need to use <em>age10</em> (instead of <em>age</em> or <em>agec</em>) and have 5 knots (not requested).</p></li>
<li><p>Plot the fitted line with its 95% band. To get a nice plot you need to fix the <em>other</em> covariates than BMI. One way to do this is to set these covariates at the mean or median value.</p></li>
</ol>
<div id="note-text" class="note">
<p>R users: The latter is provided by the R command <em>plot(Predict(fit, BMI))</em> where <em>fit</em> is the RCS fit obtained earlier. Stick to the plots obtained after fitting a RCS using <em>rms</em> and <em>ols</em> (and avoid using <em>lm</em>).</p>
<p>Stata users: You may have to be cautious here as there are other covariates than BMI. Again, follow the recommendation of Vittinghof et al.&nbsp;(2012) and use the <em>postrcspline</em> package. Recreate the splines using the command <em>mkspline2</em>. The command <em>adjustrcspline</em> used in combination with <em>at()</em> where you specify the other covariate values will give you a nice plot. The choice is up to you but we could use: the mean (or the median) age in the sample for age and 0 for nonwhite, smoking and drinkany.</p>
</div>
<ol start="4" type="1">
<li><p>Change the location of the 4 knots and refit the model. Try also a model with a different number of knots. Does it change your conclusion? Provide a qualitative interpretation of the BMI effect in the model you decide to keep.</p></li>
<li><p>Do we need a RCS model for age?</p></li>
</ol>
</section>
</section>
<section id="fractional-polynomials-and-other-methods" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fractional-polynomials-and-other-methods">Fractional polynomials and other methods</h2>
<p>RCS are not the only approach we could use to model nonlinearities. Other types of splines exist including smoothing splines that impose a penalty for a lack of smoothness, they are more nonparametric by nature. We would like to say a few words about fractional polynomials that were introduced by Royston and Atlman (1994) and further developed since then. For the sake of simplicity, we describe the procedure using a model with a single continuous covariate (called <span class="math inline">\(x\)</span>). One way to generalise the linear combination <span class="math inline">\(\beta_0 +\beta_1 x\)</span> is to replace it by a special type of polynomial that might include logarithms, noninteger powers, and repeated powers. One can show that, With a suitable range of powers, such polynomials provide a considerable range of functional forms in <span class="math inline">\(x\)</span> that are useful to model real data. They are called ``Fractional Polynomials’’ (FP) to distinguish from standard polynomials. The default set of powers from which FP powers are selected is typically <span class="math inline">\(\{−2, −1, −0.5, 0, 0.5, 1, 2, 3\}\)</span>, with 0 signifying <span class="math inline">\(\log\)</span>. There is also the convention that, every time a power repeats in an FP function of <span class="math inline">\(x\)</span>, it is multiplied by another <span class="math inline">\(\log(x)\)</span>. To describe the FP we typically list the series of powers that will be used. For example, a FP in <span class="math inline">\(x\)</span> with powers <span class="math inline">\((−1, 0, 0.5, 1)\)</span> and coefficients <span class="math inline">\(\beta\)</span> has the following form: <span class="math inline">\(\beta_1 x^{-1}+\beta_2 \log(x) + \beta_3 x^{1/2} + \beta_4 x\)</span>; also, a FP with powers <span class="math inline">\((0, 1, 2, 2)\)</span> will correspond to <span class="math inline">\(\beta_1 \log(x) + \beta_2 x +\beta_3 x^2 +\beta_4 x^2\log(x)\)</span>. Now the key issue will be to choose the best powers. Some automated procedures are available but we strongly suggest that you keep things simple and use plots (possibly some obtained using splines) to guide your choice. We do not present here a full account of this approach available in Stata through the commands <em>fp</em> and <em>mfp</em> and in R via the library <em>mfp</em>; it’s more a note mentioning that they exist and are part of a suite of techniques that could be used in model building. More will be said in week 11 in the context of logistic regression where we have more tools to decide on how to compare different models. Finally, splines and FP are not necessarily opposed. There will be situations like the triceps data where splines are more appropriate due the local flexibiliy they provide, others where FP can be valuably used to capture more general trends that can be extrapolated, and situations where they complement each other.</p>
<!-- Optional reading to add - it would be good -->
<p><strong>Lecture 2 in R</strong></p>
<iframe width="740" height="416" src="https://www.youtube.com/embed/68fndnP_PV0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p><a href="https://www.dropbox.com/s/y8nipb5qfqmcriw/RM1_week7_lecture2_R.mp4?dl=1">Download video here</a></p>
<p><strong>Lecture 2 in Stata</strong></p>
<iframe width="740" height="416" src="https://www.youtube.com/embed/2PWYd8fWniw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p><a href="https://www.dropbox.com/s/ydo0x77b7d3sa2o/RM1_week7_lecture2_Stata.mp4?dl=1">Download video here</a></p>
</section>
<section id="other-issues" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="other-issues">Other issues</h2>
<section id="bootstrapping" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="bootstrapping">Bootstrapping</h3>
<p>IN PSI you learned about the bootstrap, a resampling technique widely applicable for inference purposes. This method is very important in regression since it does not rely on normality. Therefore it can be used in situations where the normality assumption is questionable and we have doubt about the validity of standard SEs and 95%CIs. In addition, by resampling the data (i.e.&nbsp;what is called case resampling), we can also obtain valid SEs and 95%CI for complex statistics for which nothing has been implemented in standard statistical packages.</p>
<section id="reading_wk07_bootstrap" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="reading_wk07_bootstrap"><span class="citation" data-cites="vittinghoff2012">[@vittinghoff2012]</span> Chapter 3. Section 3.6 (pages 62-63).</h4>
<p>Read this short introduction to the different bootstrap CIs that are routinely available in Stata and R, namely the <em>normal approximation</em>, the <em>percentile</em> method and the <em>Bias-Corrected and accelerated (<span class="math inline">\(BCa\)</span>)</em> approach. To go beyond this succinct summary and get a bit of practice in Stata or R with this approach, we will conduct this investigation.</p>
</section>
</section>
<section id="bootstrap-investigation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="bootstrap-investigation">Bootstrap investigation</h3>
<p>Click below to see a heavily-documented code illustrating how the resampling works on the <em>hers</em> data and how we can obtain bootstrap-based 95% CIs.</p>
<p><strong>R Code</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Part A)</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(haven)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: haven</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>hers<span class="ot">&lt;-</span><span class="fu">read_dta</span>(<span class="st">"https://www.dropbox.com/s/ndtd4o20qogq7fv/hersdata.dta?dl=1"</span>) </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in open.connection(con, "rb"): HTTP error 400.</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>hers<span class="ot">&lt;-</span><span class="fu">data.frame</span>(hers)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers' not found</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>hers.nondiab<span class="ot">&lt;-</span>hers[hers<span class="sc">$</span>diabetes<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers' not found</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) standard analysis on reduced data + normal probability plot</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>hers1<span class="ot">&lt;-</span><span class="fu">cbind</span>(hers.nondiab<span class="sc">$</span>HDL,hers.nondiab<span class="sc">$</span>age,hers.nondiab<span class="sc">$</span>BMI,hers.nondiab<span class="sc">$</span>drinkany)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers.nondiab' not found</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(hers1)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"HDL"</span>,<span class="st">"age"</span>,<span class="st">"BMI"</span>,<span class="st">"drinkany"</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Error: object 'hers1' not found</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>hers1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(hers1)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers1' not found</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>hers2<span class="ot">&lt;-</span><span class="fu">na.omit</span>(hers1) <span class="co"># 2032 --&gt; 2021</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers1' not found</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the linear model (HDL on age BMI and drinkany() and draw a normality plot of the residual </span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Part A) - bootstrap "by hand"</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co"># we assumed that the reduced dataset is called hers2</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 2021 observation, 4 columns if you keep only what you need </span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="co"># (i.e. HDL, age, BM, drinkany)</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>R<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">dim</span>(hers2)[<span class="dv">1</span>]</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers2' not found</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>all.replicates<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R){</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate bootstrap sample by resampling the data</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>  hers2.r<span class="ot">=</span>hers2[<span class="fu">sample</span>(<span class="fu">nrow</span>(hers2), n,<span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fiited model (based on the bootsrap sample)</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>  out.r<span class="ot">&lt;-</span><span class="fu">lm</span>(HDL<span class="sc">~</span>age<span class="sc">+</span>BMI<span class="sc">+</span>drinkany,<span class="at">data=</span>hers2.r)</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store all coefficients in all replicates</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  all.replicates<span class="ot">=</span><span class="fu">rbind</span>(all.replicates,out.r<span class="sc">$</span>coeff)</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers2' not found</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a><span class="co"># all replicates is a matrix Rx4 (since we have R replicates</span></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a><span class="co"># and 4 coefficients in the model)</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all.replicates)</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(all.replicates)</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a><span class="co"># draw an histogram of the replicates + normal probability ploy</span></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a><span class="co"># for each coefficient</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of the replicates + normal probabilty plot</span></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) percentiles 95% CI</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a><span class="co"># get the 2.5% and 95.% percentile for each column</span></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a><span class="co"># either directly (or using apply)</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a><span class="co"># directly</span></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Part B) - bootstrap using the library boot</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------</span></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a><span class="co"># We will now use the library boot to do the same job</span></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a><span class="do">## Attaching package: 'boot'</span></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a><span class="do">## The following object is masked from 'package:survival':</span></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a><span class="do">##     aml</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a><span class="co"># function collecting the coefficients. In general this function</span></span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a><span class="co"># derive the statistic we want to bootstrap.</span></span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>coeff<span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices){</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data[indices,] <span class="co"># select obs. in bootstrap sample</span></span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(HDL<span class="sc">~</span>age<span class="sc">+</span>BMI<span class="sc">+</span>drinkany, <span class="at">data=</span>data) <span class="co"># modify formula here</span></span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coefficients</span>(mod) <span class="co"># return coefficient vector</span></span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a><span class="co"># NB: R doc says or parametric bootstrap (i.e. the one we are using)</span></span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a><span class="co">#  "the first argument to statistic must be the data"</span></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a><span class="co">#  " The second will be a vector of indices, frequencies or weights </span></span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   which define the bootstrap sample".</span></span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a><span class="co"># LS-based 95% CI</span></span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>out<span class="ot">&lt;-</span><span class="fu">lm</span>(HDL<span class="sc">~</span>age<span class="sc">+</span>BMI<span class="sc">+</span>drinkany,<span class="at">data=</span>hers2)</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(mf, parent.frame()): object 'hers2' not found</span></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(out)</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'out' not found</span></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a><span class="co"># bootsset.seed(1001)</span></span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a>B <span class="ot">=</span> <span class="fu">boot</span>(<span class="at">data=</span>hers2,<span class="at">statistic=</span>coeff,<span class="at">R=</span><span class="dv">3000</span>)  </span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers2' not found</span></span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># increase the nb of replicates for BCA </span></span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (R=1000 is too small, numerical issues)</span></span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 types for the 3rd coeff = BMI's</span></span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(B,<span class="at">index=</span><span class="dv">3</span>,<span class="at">type=</span><span class="st">"norm"</span>)   <span class="co"># normal</span></span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(B,<span class="at">index=</span><span class="dv">3</span>,<span class="at">type=</span><span class="st">"perc"</span>)   <span class="co"># percentile</span></span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(B,<span class="at">index=</span><span class="dv">3</span>,<span class="at">type=</span><span class="st">"bca"</span>)    <span class="co"># BCa CI (3 types_)</span></span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a><span class="co"># default coverage =95%</span></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a><span class="co"># all types in one command</span></span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(B,<span class="at">index=</span><span class="dv">3</span>,<span class="at">type=</span><span class="fu">c</span>(<span class="st">"norm"</span>,<span class="st">"perc"</span>, <span class="st">"bca"</span>)) </span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a><span class="co"># plots</span></span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a><span class="co"># -----</span></span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(B, <span class="at">index=</span><span class="dv">1</span>) <span class="co"># intercept</span></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(B, <span class="at">index=</span><span class="dv">2</span>) <span class="co"># x1=age</span></span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(B, <span class="at">index=</span><span class="dv">3</span>) <span class="co"># x2=BMI</span></span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(B, <span class="at">index=</span><span class="dv">4</span>) <span class="co"># x3=drinkany</span></span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a><span class="co"># nicer plots</span></span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a>all<span class="ot">&lt;-</span>B<span class="sc">$</span>t</span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(all[,<span class="dv">1</span>],<span class="at">main=</span><span class="st">"Histogram"</span>,<span class="at">xlab=</span><span class="st">"Intercept"</span>,<span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in all[, 1]: object of type 'builtin' is not subsettable</span></span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(all[,<span class="dv">1</span>])</span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in all[, 1]: object of type 'builtin' is not subsettable</span></span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(all[,<span class="dv">2</span>],<span class="at">main=</span><span class="st">"Histogram"</span>,<span class="at">xlab=</span><span class="st">"Age coeff"</span>,<span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in all[, 2]: object of type 'builtin' is not subsettable</span></span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(all[,<span class="dv">2</span>])</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in all[, 2]: object of type 'builtin' is not subsettable</span></span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a><span class="co"># etc</span></span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative coding (part B): slower </span></span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------------</span></span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a>coeff<span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices, formula){</span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data[indices,] <span class="co"># select obs. in bootstrap sample</span></span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula=</span>formula, <span class="at">data=</span>data)</span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coefficients</span>(mod) <span class="co"># return coefficient vector</span></span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a><span class="co"># percentile 95% CI, 3rd coefficient (BMI)</span></span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a>B <span class="ot">=</span> <span class="fu">boot</span>(<span class="at">data=</span>hers2,<span class="at">statistic=</span>coeff,<span class="at">R=</span><span class="dv">3000</span>, <span class="at">formula=</span>HDL<span class="sc">~</span>age<span class="sc">+</span>BMI<span class="sc">+</span>drinkany)</span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers2' not found</span></span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(B,<span class="at">index=</span><span class="dv">3</span>,<span class="at">type=</span><span class="st">"perc"</span>)</span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span>
<span id="cb62-163"><a href="#cb62-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-164"><a href="#cb62-164" aria-hidden="true" tabindex="-1"></a><span class="co"># percentile 95% CI, 4tg coefficient (drinkany)</span></span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a>B <span class="ot">=</span> <span class="fu">boot</span>(<span class="at">data=</span>hers2,<span class="at">statistic=</span>coeff,<span class="at">R=</span><span class="dv">3000</span>, <span class="at">formula=</span>HDL<span class="sc">~</span>age<span class="sc">+</span>BMI<span class="sc">+</span>drinkany)</span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'hers2' not found</span></span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(B,<span class="at">index=</span><span class="dv">4</span>,<span class="at">type=</span><span class="st">"perc"</span>)</span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in eval(expr, envir, enclos): object 'B' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Stata code</strong></p>
<div class="cell" data-collectcode="true">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>## read <span class="kw">data</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> hersdata.dta</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> diabetes ==1   <span class="co">// 731 obs deleted</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="fu">mi</span>(HDL) | <span class="fu">mi</span>(BMI) | <span class="fu">mi</span>(age) | <span class="fu">mi</span>(drinkany) <span class="co">// 11 obs deleted</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> HDL BMI age drinkany</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>## Part A) = <span class="kw">bootstrap</span> <span class="st">"by hand"</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>## =============================</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>## Writing our own <span class="kw">bootstrap</span> <span class="kw">program</span> requires four steps.</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>## 1) In the first step we obtain initial <span class="kw">estimates</span> and <span class="kw">store</span> the results <span class="kw">in</span> a <span class="fu">matrix</span>, </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>## say observe. In addition, we must also <span class="kw">note</span> the number <span class="kw">of</span> observations used <span class="kw">in</span> the analysis. </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>## This information will <span class="kw">be</span> used when we <span class="kw">summarize</span> the <span class="kw">bootstrap</span> results.</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>## 2) Second, we write a <span class="kw">program</span> which we will call myboot that samples the </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>## <span class="kw">data</span> with replacement and returns the statistic <span class="kw">of</span> interest. In <span class="kw">this</span> step, </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>## we <span class="bn">start</span> <span class="kw">by</span> preserving the <span class="kw">data</span> with the <span class="kw">preserve</span> command, then take a <span class="kw">bootstrap</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>## <span class="kw">sample</span> with <span class="kw">bsample</span>. <span class="kw">bsample</span> samples the <span class="kw">data</span> <span class="kw">in</span> <span class="dv">memory</span> with replacement,</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>## which is the essential element <span class="kw">of</span> the <span class="kw">bootstrap</span>. From the <span class="kw">bootstrap</span> <span class="kw">sample</span> </span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>## we <span class="kw">run</span> our regression <span class="kw">model</span> and output the statistic <span class="kw">of</span> interest with the <span class="fu">return</span> </span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>## <span class="fu">scalar</span> command. Note that when we <span class="kw">define</span> the <span class="kw">program</span>, <span class="kw">program</span> <span class="kw">define</span> myboot, </span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>## we specify the rclass option; without that option, we would <span class="kw">not</span> <span class="kw">be</span> able to output </span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>## the bootstrapped statistic. myboot concludes with the <span class="kw">restore</span> command, </span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>## which returns the <span class="kw">data</span> to the original state (prior to the bootstrapped <span class="kw">sample</span>).</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>## 3) In the third step, we <span class="kw">use</span> the <span class="kw">simulate</span> <span class="kw">prefix</span> command along with myboot, </span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>## which collects the statistic from the bootstrapped <span class="kw">sample</span>. </span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>## We specify the <span class="dv">seed</span> and number <span class="kw">of</span> replications <span class="fu">at</span> <span class="kw">this</span> step, which coincide </span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>## with those from the example above.</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>## 4) Finally, we <span class="kw">use</span> the <span class="kw">bstat</span> command to <span class="kw">summarize</span> the results. </span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>## We <span class="kw">include</span> the initial <span class="kw">estimates</span>, stored <span class="kw">in</span> the <span class="fu">matrix</span> observe, and the </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>## <span class="kw">sample</span> <span class="kw">size</span> with the stat( ) and n() options, respectively.</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>## Step 1 - <span class="kw">define</span> <span class="kw">model</span> and <span class="kw">store</span> the coefficients via the observe command</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> HDL BMI age drinkany </span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> observe= (_b[<span class="dt">_cons</span>], _b[BMI], _b[age], _b[drinkany])</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> <span class="ot">list</span> observe</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>## Step 2 - <span class="kw">program</span> to <span class="kw">be</span> repeated</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> myboot2</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> myboot2, rclass</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a> <span class="kw">preserve</span> </span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">bsample</span></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">regress</span> HDL BMI age drinkany  </span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>    ## <span class="kw">fit</span> <span class="kw">model</span>, <span class="kw">store</span> coeff </span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="fu">scalar</span> b0 = _b[<span class="dt">_cons</span>]</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> b1 = _b[BMI]</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> b2 = _b[age]</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> b3 = _b[drinkany]</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a> <span class="kw">restore</span></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>## Step 3 - simulation = resampling the <span class="kw">data</span> <span class="kw">using</span> the <span class="kw">program</span> myboot2, R=1000 replicates</span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>  b0=<span class="fu">r</span>(b0) b1=<span class="fu">r</span>(b1) b2=<span class="fu">r</span>(b2) b3=<span class="fu">r</span>(b3), reps(1000) <span class="dv">seed</span>(12345): myboot2</span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a>## Step 4 - compute 95% CIs</span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="kw">bstat</span>, stat(observe) n(2021) </span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a>                    ## n = nb <span class="kw">of</span> observations --&gt; CAUTION HERE</span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">bootstrap</span>, <span class="ot">all</span></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a>## NB: you can reduce the output <span class="kw">of</span> <span class="kw">estat</span> <span class="kw">bootstrap</span> <span class="kw">by</span> specifying </span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a>## the option (<span class="fu">e</span>.g. percentile) instead <span class="kw">of</span> <span class="ot">all</span> </span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">bootstrap</span>, percentile</span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a>## NB: you can change the number <span class="kw">of</span> replicates i.<span class="fu">e</span>. the argument <span class="kw">of</span> reps()</span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a>##     we need <span class="fu">at</span> least 1000 replicates <span class="kw">for</span> 95% CU</span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a>##     The <span class="dv">seed</span> <span class="kw">use</span> here is only there to replicate the simulations</span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a>##     <span class="kw">if</span> you don't specify a <span class="dv">seed</span>, a random <span class="dv">seed</span> will <span class="kw">be</span> chosen and different results</span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a>##     will <span class="kw">be</span> obtained each time (very similar though). The difference is due to the</span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a>##     Monte Carlo variability.</span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a>##  select the code above and <span class="kw">run</span></span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a>## NB: browse the active dataset, the dimension and the <span class="kw">columns</span>. NO LONGER hers</span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a><span class="kw">desc</span></span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="kw">if</span> <span class="dt">_n</span>&lt;20 </span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a>#  percentile CI <span class="kw">for</span> each coefficient &amp; <span class="kw">histogram</span></span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a>#  ------------------------------------------------</span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a>## write a one <span class="kw">line</span> command <span class="kw">for</span> the <span class="kw">histogram</span> and another <span class="kw">line</span> <span class="kw">for</span> the percentile CI (per coefficient)</span>
<span id="cb63-94"><a href="#cb63-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-95"><a href="#cb63-95" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-96"><a href="#cb63-96" aria-hidden="true" tabindex="-1"></a>##  4) boostrap  <span class="kw">using</span> the libary <span class="kw">boot</span> - <span class="kw">use</span> Part B below</span>
<span id="cb63-97"><a href="#cb63-97" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-98"><a href="#cb63-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-99"><a href="#cb63-99" aria-hidden="true" tabindex="-1"></a># Part B) <span class="kw">use</span> a Stata command - SIMPLER</span>
<span id="cb63-100"><a href="#cb63-100" aria-hidden="true" tabindex="-1"></a># ======================================</span>
<span id="cb63-101"><a href="#cb63-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-102"><a href="#cb63-102" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-103"><a href="#cb63-103" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb63-104"><a href="#cb63-104" aria-hidden="true" tabindex="-1"></a>## read the dataset again</span>
<span id="cb63-105"><a href="#cb63-105" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-106"><a href="#cb63-106" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> hersdata.dta</span>
<span id="cb63-107"><a href="#cb63-107" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> diabetes ==1  </span>
<span id="cb63-108"><a href="#cb63-108" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="fu">mi</span>(HDL) | <span class="fu">mi</span>(BMI) | <span class="fu">mi</span>(age) | <span class="fu">mi</span>(drinkany) </span>
<span id="cb63-109"><a href="#cb63-109" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> HDL BMI age drinkany</span>
<span id="cb63-110"><a href="#cb63-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-111"><a href="#cb63-111" aria-hidden="true" tabindex="-1"></a><span class="kw">bootstrap</span>, reps(1000)  <span class="dv">seed</span>(12345): <span class="kw">regress</span> HDL BMI age drinkany  </span>
<span id="cb63-112"><a href="#cb63-112" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">bootstrap</span>, <span class="ot">all</span>        </span>
<span id="cb63-113"><a href="#cb63-113" aria-hidden="true" tabindex="-1"></a>## <span class="ot">all</span> 3 types</span>
<span id="cb63-114"><a href="#cb63-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-115"><a href="#cb63-115" aria-hidden="true" tabindex="-1"></a><span class="kw">bootstrap</span>, reps(1000)  <span class="dv">seed</span>(12345): <span class="kw">regress</span> HDL BMI age drinkany </span>
<span id="cb63-116"><a href="#cb63-116" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">bootstrap</span>, percentile </span>
<span id="cb63-117"><a href="#cb63-117" aria-hidden="true" tabindex="-1"></a>## percentile</span>
<span id="cb63-118"><a href="#cb63-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-119"><a href="#cb63-119" aria-hidden="true" tabindex="-1"></a><span class="kw">bootstrap</span>, reps(1000)  <span class="dv">seed</span>(12345): <span class="kw">regress</span> HDL BMI age drinkany </span>
<span id="cb63-120"><a href="#cb63-120" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">bootstrap</span>, <span class="fu">normal</span>     </span>
<span id="cb63-121"><a href="#cb63-121" aria-hidden="true" tabindex="-1"></a>## <span class="fu">normal</span></span>
<span id="cb63-122"><a href="#cb63-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-123"><a href="#cb63-123" aria-hidden="true" tabindex="-1"></a>## to <span class="fu">get</span> the BCa option alone, <span class="dv">type</span> <span class="kw">this</span></span>
<span id="cb63-124"><a href="#cb63-124" aria-hidden="true" tabindex="-1"></a><span class="kw">bootstrap</span>, bca reps(1000)  <span class="dv">seed</span>(12345): <span class="kw">regress</span> HDL BMI age drinkany  </span>
<span id="cb63-125"><a href="#cb63-125" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">bootstrap</span>     </span>
<span id="cb63-126"><a href="#cb63-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-127"><a href="#cb63-127" aria-hidden="true" tabindex="-1"></a>## again you can <span class="kw">use</span> <span class="kw">more</span> than 1000 replicates and change the <span class="dv">seed</span></span>
<span id="cb63-128"><a href="#cb63-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-129"><a href="#cb63-129" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-130"><a href="#cb63-130" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-131"><a href="#cb63-131" aria-hidden="true" tabindex="-1"></a>## (731 observations deleted)</span>
<span id="cb63-132"><a href="#cb63-132" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-133"><a href="#cb63-133" aria-hidden="true" tabindex="-1"></a>## (11 observations deleted)</span>
<span id="cb63-134"><a href="#cb63-134" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-135"><a href="#cb63-135" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-136"><a href="#cb63-136" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-137"><a href="#cb63-137" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-138"><a href="#cb63-138" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-139"><a href="#cb63-139" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-140"><a href="#cb63-140" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-141"><a href="#cb63-141" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-142"><a href="#cb63-142" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-143"><a href="#cb63-143" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-144"><a href="#cb63-144" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-145"><a href="#cb63-145" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-146"><a href="#cb63-146" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-147"><a href="#cb63-147" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-148"><a href="#cb63-148" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-149"><a href="#cb63-149" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-150"><a href="#cb63-150" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-151"><a href="#cb63-151" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-152"><a href="#cb63-152" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-153"><a href="#cb63-153" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-154"><a href="#cb63-154" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-155"><a href="#cb63-155" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-156"><a href="#cb63-156" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-157"><a href="#cb63-157" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-158"><a href="#cb63-158" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-159"><a href="#cb63-159" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-160"><a href="#cb63-160" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-161"><a href="#cb63-161" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-162"><a href="#cb63-162" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-163"><a href="#cb63-163" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-164"><a href="#cb63-164" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-165"><a href="#cb63-165" aria-hidden="true" tabindex="-1"></a>##       Source |       SS           df       MS      Number <span class="kw">of</span> <span class="kw">obs</span>   =     2,021</span>
<span id="cb63-166"><a href="#cb63-166" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------   <span class="fu">F</span>(3, 2017)      =     46.91</span>
<span id="cb63-167"><a href="#cb63-167" aria-hidden="true" tabindex="-1"></a>##        Model |  24006.0684         3  8002.02279   Prob &gt; <span class="fu">F</span>        =    0.0000</span>
<span id="cb63-168"><a href="#cb63-168" aria-hidden="true" tabindex="-1"></a>##     Residual |  344071.218     2,017  170.585631   R-squared       =    0.0652</span>
<span id="cb63-169"><a href="#cb63-169" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------   Adj R-squared   =    0.0638</span>
<span id="cb63-170"><a href="#cb63-170" aria-hidden="true" tabindex="-1"></a>##        Total |  368077.286     2,020  182.216478   Root MSE        =    13.061</span>
<span id="cb63-171"><a href="#cb63-171" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-172"><a href="#cb63-172" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-173"><a href="#cb63-173" aria-hidden="true" tabindex="-1"></a>##          HDL | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb63-174"><a href="#cb63-174" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-175"><a href="#cb63-175" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.4036859   .0571063    -7.07   0.000    -.5156793   -.2916924</span>
<span id="cb63-176"><a href="#cb63-176" aria-hidden="true" tabindex="-1"></a>##          age |   .2086808   .0437416     4.77   0.000     .1228974    .2944643</span>
<span id="cb63-177"><a href="#cb63-177" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.502504   .5880671     7.66   0.000     3.349222    5.655787</span>
<span id="cb63-178"><a href="#cb63-178" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.68225   3.571831    13.07   0.000     39.67739    53.68712</span>
<span id="cb63-179"><a href="#cb63-179" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-180"><a href="#cb63-180" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-181"><a href="#cb63-181" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-182"><a href="#cb63-182" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-183"><a href="#cb63-183" aria-hidden="true" tabindex="-1"></a>## observe[1,4]</span>
<span id="cb63-184"><a href="#cb63-184" aria-hidden="true" tabindex="-1"></a>##             c1          c2          c3          c4</span>
<span id="cb63-185"><a href="#cb63-185" aria-hidden="true" tabindex="-1"></a>## r1   46.682253  -.40368587   .20868084   4.5025044</span>
<span id="cb63-186"><a href="#cb63-186" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-187"><a href="#cb63-187" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-188"><a href="#cb63-188" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-189"><a href="#cb63-189" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-190"><a href="#cb63-190" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-191"><a href="#cb63-191" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-192"><a href="#cb63-192" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-193"><a href="#cb63-193" aria-hidden="true" tabindex="-1"></a>##       Command: myboot2</span>
<span id="cb63-194"><a href="#cb63-194" aria-hidden="true" tabindex="-1"></a>##            b0: <span class="fu">r</span>(b0)</span>
<span id="cb63-195"><a href="#cb63-195" aria-hidden="true" tabindex="-1"></a>##            b1: <span class="fu">r</span>(b1)</span>
<span id="cb63-196"><a href="#cb63-196" aria-hidden="true" tabindex="-1"></a>##            b2: <span class="fu">r</span>(b2)</span>
<span id="cb63-197"><a href="#cb63-197" aria-hidden="true" tabindex="-1"></a>##            b3: <span class="fu">r</span>(b3)</span>
<span id="cb63-198"><a href="#cb63-198" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-199"><a href="#cb63-199" aria-hidden="true" tabindex="-1"></a>## Simulations (1,000)</span>
<span id="cb63-200"><a href="#cb63-200" aria-hidden="true" tabindex="-1"></a>## ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 </span>
<span id="cb63-201"><a href="#cb63-201" aria-hidden="true" tabindex="-1"></a>## ..................................................    50</span>
<span id="cb63-202"><a href="#cb63-202" aria-hidden="true" tabindex="-1"></a>## ..................................................   100</span>
<span id="cb63-203"><a href="#cb63-203" aria-hidden="true" tabindex="-1"></a>## ..................................................   150</span>
<span id="cb63-204"><a href="#cb63-204" aria-hidden="true" tabindex="-1"></a>## ..................................................   200</span>
<span id="cb63-205"><a href="#cb63-205" aria-hidden="true" tabindex="-1"></a>## ..................................................   250</span>
<span id="cb63-206"><a href="#cb63-206" aria-hidden="true" tabindex="-1"></a>## ..................................................   300</span>
<span id="cb63-207"><a href="#cb63-207" aria-hidden="true" tabindex="-1"></a>## ..................................................   350</span>
<span id="cb63-208"><a href="#cb63-208" aria-hidden="true" tabindex="-1"></a>## ..................................................   400</span>
<span id="cb63-209"><a href="#cb63-209" aria-hidden="true" tabindex="-1"></a>## ..................................................   450</span>
<span id="cb63-210"><a href="#cb63-210" aria-hidden="true" tabindex="-1"></a>## ..................................................   500</span>
<span id="cb63-211"><a href="#cb63-211" aria-hidden="true" tabindex="-1"></a>## ..................................................   550</span>
<span id="cb63-212"><a href="#cb63-212" aria-hidden="true" tabindex="-1"></a>## ..................................................   600</span>
<span id="cb63-213"><a href="#cb63-213" aria-hidden="true" tabindex="-1"></a>## ..................................................   650</span>
<span id="cb63-214"><a href="#cb63-214" aria-hidden="true" tabindex="-1"></a>## ..................................................   700</span>
<span id="cb63-215"><a href="#cb63-215" aria-hidden="true" tabindex="-1"></a>## ..................................................   750</span>
<span id="cb63-216"><a href="#cb63-216" aria-hidden="true" tabindex="-1"></a>## ..................................................   800</span>
<span id="cb63-217"><a href="#cb63-217" aria-hidden="true" tabindex="-1"></a>## ..................................................   850</span>
<span id="cb63-218"><a href="#cb63-218" aria-hidden="true" tabindex="-1"></a>## ..................................................   900</span>
<span id="cb63-219"><a href="#cb63-219" aria-hidden="true" tabindex="-1"></a>## ..................................................   950</span>
<span id="cb63-220"><a href="#cb63-220" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,000</span>
<span id="cb63-221"><a href="#cb63-221" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-222"><a href="#cb63-222" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-223"><a href="#cb63-223" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-224"><a href="#cb63-224" aria-hidden="true" tabindex="-1"></a>## Bootstrap results                                        Number <span class="kw">of</span> <span class="kw">obs</span> = 2,021</span>
<span id="cb63-225"><a href="#cb63-225" aria-hidden="true" tabindex="-1"></a>##                                                          Replications  = 1,000</span>
<span id="cb63-226"><a href="#cb63-226" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-227"><a href="#cb63-227" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-228"><a href="#cb63-228" aria-hidden="true" tabindex="-1"></a>##              |   Observed   Bootstrap                         Normal-based</span>
<span id="cb63-229"><a href="#cb63-229" aria-hidden="true" tabindex="-1"></a>##              | coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb63-230"><a href="#cb63-230" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-231"><a href="#cb63-231" aria-hidden="true" tabindex="-1"></a>##           b0 |   46.68225   3.455292    13.51   0.000     39.91001     53.4545</span>
<span id="cb63-232"><a href="#cb63-232" aria-hidden="true" tabindex="-1"></a>##           b1 |  -.4036859   .0548886    -7.35   0.000    -.5112656   -.2961062</span>
<span id="cb63-233"><a href="#cb63-233" aria-hidden="true" tabindex="-1"></a>##           b2 |   .2086808   .0430616     4.85   0.000     .1242817      .29308</span>
<span id="cb63-234"><a href="#cb63-234" aria-hidden="true" tabindex="-1"></a>##           b3 |   4.502504   .5957828     7.56   0.000     3.334792    5.670217</span>
<span id="cb63-235"><a href="#cb63-235" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-236"><a href="#cb63-236" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-237"><a href="#cb63-237" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-238"><a href="#cb63-238" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-239"><a href="#cb63-239" aria-hidden="true" tabindex="-1"></a>## Bootstrap results                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,021</span>
<span id="cb63-240"><a href="#cb63-240" aria-hidden="true" tabindex="-1"></a>##                                                 Replications      =       1000</span>
<span id="cb63-241"><a href="#cb63-241" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-242"><a href="#cb63-242" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-243"><a href="#cb63-243" aria-hidden="true" tabindex="-1"></a>##              |    Observed               Bootstrap</span>
<span id="cb63-244"><a href="#cb63-244" aria-hidden="true" tabindex="-1"></a>##              | coefficient       Bias    <span class="fu">std</span>. err.  [95% conf. interval]</span>
<span id="cb63-245"><a href="#cb63-245" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-246"><a href="#cb63-246" aria-hidden="true" tabindex="-1"></a>##           b0 |   46.682253   .1759177   3.4552918    39.91001    53.4545   (<span class="kw">N</span>)</span>
<span id="cb63-247"><a href="#cb63-247" aria-hidden="true" tabindex="-1"></a>##              |                                       40.42489   54.07221   (P)</span>
<span id="cb63-248"><a href="#cb63-248" aria-hidden="true" tabindex="-1"></a>##              |                                       39.84275   53.29212  (BC)</span>
<span id="cb63-249"><a href="#cb63-249" aria-hidden="true" tabindex="-1"></a>##           b1 |  -.40368587  -.0038854    .0548886   -.5112656  -.2961062   (<span class="kw">N</span>)</span>
<span id="cb63-250"><a href="#cb63-250" aria-hidden="true" tabindex="-1"></a>##              |                                      -.5188768  -.2992493   (P)</span>
<span id="cb63-251"><a href="#cb63-251" aria-hidden="true" tabindex="-1"></a>##              |                                       -.507547  -.2924751  (BC)</span>
<span id="cb63-252"><a href="#cb63-252" aria-hidden="true" tabindex="-1"></a>##           b2 |   .20868084  -.0009771   .04306157    .1242817     .29308   (<span class="kw">N</span>)</span>
<span id="cb63-253"><a href="#cb63-253" aria-hidden="true" tabindex="-1"></a>##              |                                        .117856   .2910675   (P)</span>
<span id="cb63-254"><a href="#cb63-254" aria-hidden="true" tabindex="-1"></a>##              |                                       .1173203   .2900742  (BC)</span>
<span id="cb63-255"><a href="#cb63-255" aria-hidden="true" tabindex="-1"></a>##           b3 |   4.5025044   .0024019   .59578279    3.334792   5.670217   (<span class="kw">N</span>)</span>
<span id="cb63-256"><a href="#cb63-256" aria-hidden="true" tabindex="-1"></a>##              |                                       3.368253   5.692966   (P)</span>
<span id="cb63-257"><a href="#cb63-257" aria-hidden="true" tabindex="-1"></a>##              |                                       3.405528   5.748656  (BC)</span>
<span id="cb63-258"><a href="#cb63-258" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-259"><a href="#cb63-259" aria-hidden="true" tabindex="-1"></a>## Key:  <span class="kw">N</span>: Normal</span>
<span id="cb63-260"><a href="#cb63-260" aria-hidden="true" tabindex="-1"></a>##       P: Percentile</span>
<span id="cb63-261"><a href="#cb63-261" aria-hidden="true" tabindex="-1"></a>##      BC: Bias-corrected</span>
<span id="cb63-262"><a href="#cb63-262" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-263"><a href="#cb63-263" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-264"><a href="#cb63-264" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-265"><a href="#cb63-265" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-266"><a href="#cb63-266" aria-hidden="true" tabindex="-1"></a>## Bootstrap results                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,021</span>
<span id="cb63-267"><a href="#cb63-267" aria-hidden="true" tabindex="-1"></a>##                                                 Replications      =       1000</span>
<span id="cb63-268"><a href="#cb63-268" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-269"><a href="#cb63-269" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-270"><a href="#cb63-270" aria-hidden="true" tabindex="-1"></a>##              |    Observed               Bootstrap</span>
<span id="cb63-271"><a href="#cb63-271" aria-hidden="true" tabindex="-1"></a>##              | coefficient       Bias    <span class="fu">std</span>. err.  [95% conf. interval]</span>
<span id="cb63-272"><a href="#cb63-272" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-273"><a href="#cb63-273" aria-hidden="true" tabindex="-1"></a>##           b0 |   46.682253   .1759177   3.4552918    40.42489   54.07221   (P)</span>
<span id="cb63-274"><a href="#cb63-274" aria-hidden="true" tabindex="-1"></a>##           b1 |  -.40368587  -.0038854    .0548886   -.5188768  -.2992493   (P)</span>
<span id="cb63-275"><a href="#cb63-275" aria-hidden="true" tabindex="-1"></a>##           b2 |   .20868084  -.0009771   .04306157     .117856   .2910675   (P)</span>
<span id="cb63-276"><a href="#cb63-276" aria-hidden="true" tabindex="-1"></a>##           b3 |   4.5025044   .0024019   .59578279    3.368253   5.692966   (P)</span>
<span id="cb63-277"><a href="#cb63-277" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-278"><a href="#cb63-278" aria-hidden="true" tabindex="-1"></a>## Key: P: Percentile</span>
<span id="cb63-279"><a href="#cb63-279" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-280"><a href="#cb63-280" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-281"><a href="#cb63-281" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-282"><a href="#cb63-282" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-283"><a href="#cb63-283" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-284"><a href="#cb63-284" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-285"><a href="#cb63-285" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-286"><a href="#cb63-286" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-287"><a href="#cb63-287" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-288"><a href="#cb63-288" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-289"><a href="#cb63-289" aria-hidden="true" tabindex="-1"></a>## Contains <span class="kw">data</span></span>
<span id="cb63-290"><a href="#cb63-290" aria-hidden="true" tabindex="-1"></a>##  Observations:         1,000                  <span class="kw">simulate</span>: myboot2</span>
<span id="cb63-291"><a href="#cb63-291" aria-hidden="true" tabindex="-1"></a>##     Variables:             4                  13 Feb 2024 11:05</span>
<span id="cb63-292"><a href="#cb63-292" aria-hidden="true" tabindex="-1"></a>## -------------------------------------------------------------------------------------------------------------------------------</span>
<span id="cb63-293"><a href="#cb63-293" aria-hidden="true" tabindex="-1"></a>## Variable      Storage   Display    Value</span>
<span id="cb63-294"><a href="#cb63-294" aria-hidden="true" tabindex="-1"></a>##     <span class="bn">name</span>         <span class="dv">type</span>    <span class="kw">format</span>    <span class="kw">label</span>      Variable <span class="kw">label</span></span>
<span id="cb63-295"><a href="#cb63-295" aria-hidden="true" tabindex="-1"></a>## -------------------------------------------------------------------------------------------------------------------------------</span>
<span id="cb63-296"><a href="#cb63-296" aria-hidden="true" tabindex="-1"></a>## b0              <span class="kw">float</span>   %9.0g                 <span class="fu">r</span>(b0)</span>
<span id="cb63-297"><a href="#cb63-297" aria-hidden="true" tabindex="-1"></a>## b1              <span class="kw">float</span>   %9.0g                 <span class="fu">r</span>(b1)</span>
<span id="cb63-298"><a href="#cb63-298" aria-hidden="true" tabindex="-1"></a>## b2              <span class="kw">float</span>   %9.0g                 <span class="fu">r</span>(b2)</span>
<span id="cb63-299"><a href="#cb63-299" aria-hidden="true" tabindex="-1"></a>## b3              <span class="kw">float</span>   %9.0g                 <span class="fu">r</span>(b3)</span>
<span id="cb63-300"><a href="#cb63-300" aria-hidden="true" tabindex="-1"></a>## -------------------------------------------------------------------------------------------------------------------------------</span>
<span id="cb63-301"><a href="#cb63-301" aria-hidden="true" tabindex="-1"></a>## Sorted <span class="kw">by</span>: </span>
<span id="cb63-302"><a href="#cb63-302" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-303"><a href="#cb63-303" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-304"><a href="#cb63-304" aria-hidden="true" tabindex="-1"></a>##       +--------------------------------------------+</span>
<span id="cb63-305"><a href="#cb63-305" aria-hidden="true" tabindex="-1"></a>##       |       b0          b1         b2         b3 |</span>
<span id="cb63-306"><a href="#cb63-306" aria-hidden="true" tabindex="-1"></a>##       |--------------------------------------------|</span>
<span id="cb63-307"><a href="#cb63-307" aria-hidden="true" tabindex="-1"></a>##    1. |  55.0277    -.507547   .1273913   4.579051 |</span>
<span id="cb63-308"><a href="#cb63-308" aria-hidden="true" tabindex="-1"></a>##    2. | 43.05033   -.3214125   .2198346    4.56848 |</span>
<span id="cb63-309"><a href="#cb63-309" aria-hidden="true" tabindex="-1"></a>##    3. | 41.79856   -.3580904   .2595156   4.108671 |</span>
<span id="cb63-310"><a href="#cb63-310" aria-hidden="true" tabindex="-1"></a>##    4. | 47.37144   -.3629469   .1825078   4.238028 |</span>
<span id="cb63-311"><a href="#cb63-311" aria-hidden="true" tabindex="-1"></a>##    5. | 45.83468   -.3676654   .2150579   3.279417 |</span>
<span id="cb63-312"><a href="#cb63-312" aria-hidden="true" tabindex="-1"></a>##       |--------------------------------------------|</span>
<span id="cb63-313"><a href="#cb63-313" aria-hidden="true" tabindex="-1"></a>##    6. | 43.68774   -.4242001   .2591675   4.742793 |</span>
<span id="cb63-314"><a href="#cb63-314" aria-hidden="true" tabindex="-1"></a>##    7. | 46.68452   -.4392134   .2143669   5.071074 |</span>
<span id="cb63-315"><a href="#cb63-315" aria-hidden="true" tabindex="-1"></a>##    8. | 46.22334   -.3971224   .2033755   5.373112 |</span>
<span id="cb63-316"><a href="#cb63-316" aria-hidden="true" tabindex="-1"></a>##    9. | 45.68821   -.4942878   .2594136   4.191213 |</span>
<span id="cb63-317"><a href="#cb63-317" aria-hidden="true" tabindex="-1"></a>##   10. |  45.2424   -.3911622   .2145017   5.476406 |</span>
<span id="cb63-318"><a href="#cb63-318" aria-hidden="true" tabindex="-1"></a>##       |--------------------------------------------|</span>
<span id="cb63-319"><a href="#cb63-319" aria-hidden="true" tabindex="-1"></a>##   11. |  48.1397   -.3311509   .1490672   5.302119 |</span>
<span id="cb63-320"><a href="#cb63-320" aria-hidden="true" tabindex="-1"></a>##   12. | 50.02382    -.433796   .1687294   5.122212 |</span>
<span id="cb63-321"><a href="#cb63-321" aria-hidden="true" tabindex="-1"></a>##   13. | 41.93714   -.3431965   .2403703   5.655903 |</span>
<span id="cb63-322"><a href="#cb63-322" aria-hidden="true" tabindex="-1"></a>##   14. | 43.53362   -.3849073   .2465488   4.113903 |</span>
<span id="cb63-323"><a href="#cb63-323" aria-hidden="true" tabindex="-1"></a>##   15. |   45.835    -.441162   .2361516   4.045438 |</span>
<span id="cb63-324"><a href="#cb63-324" aria-hidden="true" tabindex="-1"></a>##       |--------------------------------------------|</span>
<span id="cb63-325"><a href="#cb63-325" aria-hidden="true" tabindex="-1"></a>##   16. | 46.65306   -.4823789   .2538138   3.141874 |</span>
<span id="cb63-326"><a href="#cb63-326" aria-hidden="true" tabindex="-1"></a>##   17. | 44.25373   -.3605336   .2135229   5.084305 |</span>
<span id="cb63-327"><a href="#cb63-327" aria-hidden="true" tabindex="-1"></a>##   18. | 49.38696   -.4354429   .1772449   5.243911 |</span>
<span id="cb63-328"><a href="#cb63-328" aria-hidden="true" tabindex="-1"></a>##   19. | 44.58269   -.4229109   .2491518   4.564682 |</span>
<span id="cb63-329"><a href="#cb63-329" aria-hidden="true" tabindex="-1"></a>##       +--------------------------------------------+</span>
<span id="cb63-330"><a href="#cb63-330" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-331"><a href="#cb63-331" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-332"><a href="#cb63-332" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-333"><a href="#cb63-333" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-334"><a href="#cb63-334" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-335"><a href="#cb63-335" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-336"><a href="#cb63-336" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-337"><a href="#cb63-337" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-338"><a href="#cb63-338" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-339"><a href="#cb63-339" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-340"><a href="#cb63-340" aria-hidden="true" tabindex="-1"></a>## (731 observations deleted)</span>
<span id="cb63-341"><a href="#cb63-341" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-342"><a href="#cb63-342" aria-hidden="true" tabindex="-1"></a>## (11 observations deleted)</span>
<span id="cb63-343"><a href="#cb63-343" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-344"><a href="#cb63-344" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-345"><a href="#cb63-345" aria-hidden="true" tabindex="-1"></a>## (running <span class="kw">regress</span> <span class="kw">on</span> estimation <span class="kw">sample</span>)</span>
<span id="cb63-346"><a href="#cb63-346" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-347"><a href="#cb63-347" aria-hidden="true" tabindex="-1"></a>## Bootstrap replications (1,000)</span>
<span id="cb63-348"><a href="#cb63-348" aria-hidden="true" tabindex="-1"></a>## ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 </span>
<span id="cb63-349"><a href="#cb63-349" aria-hidden="true" tabindex="-1"></a>## ..................................................    50</span>
<span id="cb63-350"><a href="#cb63-350" aria-hidden="true" tabindex="-1"></a>## ..................................................   100</span>
<span id="cb63-351"><a href="#cb63-351" aria-hidden="true" tabindex="-1"></a>## ..................................................   150</span>
<span id="cb63-352"><a href="#cb63-352" aria-hidden="true" tabindex="-1"></a>## ..................................................   200</span>
<span id="cb63-353"><a href="#cb63-353" aria-hidden="true" tabindex="-1"></a>## ..................................................   250</span>
<span id="cb63-354"><a href="#cb63-354" aria-hidden="true" tabindex="-1"></a>## ..................................................   300</span>
<span id="cb63-355"><a href="#cb63-355" aria-hidden="true" tabindex="-1"></a>## ..................................................   350</span>
<span id="cb63-356"><a href="#cb63-356" aria-hidden="true" tabindex="-1"></a>## ..................................................   400</span>
<span id="cb63-357"><a href="#cb63-357" aria-hidden="true" tabindex="-1"></a>## ..................................................   450</span>
<span id="cb63-358"><a href="#cb63-358" aria-hidden="true" tabindex="-1"></a>## ..................................................   500</span>
<span id="cb63-359"><a href="#cb63-359" aria-hidden="true" tabindex="-1"></a>## ..................................................   550</span>
<span id="cb63-360"><a href="#cb63-360" aria-hidden="true" tabindex="-1"></a>## ..................................................   600</span>
<span id="cb63-361"><a href="#cb63-361" aria-hidden="true" tabindex="-1"></a>## ..................................................   650</span>
<span id="cb63-362"><a href="#cb63-362" aria-hidden="true" tabindex="-1"></a>## ..................................................   700</span>
<span id="cb63-363"><a href="#cb63-363" aria-hidden="true" tabindex="-1"></a>## ..................................................   750</span>
<span id="cb63-364"><a href="#cb63-364" aria-hidden="true" tabindex="-1"></a>## ..................................................   800</span>
<span id="cb63-365"><a href="#cb63-365" aria-hidden="true" tabindex="-1"></a>## ..................................................   850</span>
<span id="cb63-366"><a href="#cb63-366" aria-hidden="true" tabindex="-1"></a>## ..................................................   900</span>
<span id="cb63-367"><a href="#cb63-367" aria-hidden="true" tabindex="-1"></a>## ..................................................   950</span>
<span id="cb63-368"><a href="#cb63-368" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,000</span>
<span id="cb63-369"><a href="#cb63-369" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-370"><a href="#cb63-370" aria-hidden="true" tabindex="-1"></a>## Linear regression                                      Number <span class="kw">of</span> <span class="kw">obs</span> =   2,021</span>
<span id="cb63-371"><a href="#cb63-371" aria-hidden="true" tabindex="-1"></a>##                                                        Replications  =   1,000</span>
<span id="cb63-372"><a href="#cb63-372" aria-hidden="true" tabindex="-1"></a>##                                                        Wald <span class="fu">chi2</span>(3)  =  122.77</span>
<span id="cb63-373"><a href="#cb63-373" aria-hidden="true" tabindex="-1"></a>##                                                        Prob &gt; <span class="fu">chi2</span>   =  0.0000</span>
<span id="cb63-374"><a href="#cb63-374" aria-hidden="true" tabindex="-1"></a>##                                                        R-squared     =  0.0652</span>
<span id="cb63-375"><a href="#cb63-375" aria-hidden="true" tabindex="-1"></a>##                                                        Adj R-squared =  0.0638</span>
<span id="cb63-376"><a href="#cb63-376" aria-hidden="true" tabindex="-1"></a>##                                                        Root MSE      = 13.0608</span>
<span id="cb63-377"><a href="#cb63-377" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-378"><a href="#cb63-378" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-379"><a href="#cb63-379" aria-hidden="true" tabindex="-1"></a>##              |   Observed   Bootstrap                         Normal-based</span>
<span id="cb63-380"><a href="#cb63-380" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb63-381"><a href="#cb63-381" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-382"><a href="#cb63-382" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.4036859   .0548886    -7.35   0.000    -.5112656   -.2961062</span>
<span id="cb63-383"><a href="#cb63-383" aria-hidden="true" tabindex="-1"></a>##          age |   .2086808   .0430616     4.85   0.000     .1242817      .29308</span>
<span id="cb63-384"><a href="#cb63-384" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.502504   .5957828     7.56   0.000     3.334792    5.670217</span>
<span id="cb63-385"><a href="#cb63-385" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.68225   3.455292    13.51   0.000     39.91001     53.4545</span>
<span id="cb63-386"><a href="#cb63-386" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-387"><a href="#cb63-387" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-388"><a href="#cb63-388" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-389"><a href="#cb63-389" aria-hidden="true" tabindex="-1"></a>## Linear regression                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,021</span>
<span id="cb63-390"><a href="#cb63-390" aria-hidden="true" tabindex="-1"></a>##                                                 Replications      =       1000</span>
<span id="cb63-391"><a href="#cb63-391" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-392"><a href="#cb63-392" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-393"><a href="#cb63-393" aria-hidden="true" tabindex="-1"></a>##              |    Observed               Bootstrap</span>
<span id="cb63-394"><a href="#cb63-394" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient       Bias    <span class="fu">std</span>. err.  [95% conf. interval]</span>
<span id="cb63-395"><a href="#cb63-395" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-396"><a href="#cb63-396" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.40368587  -.0038854    .0548886   -.5112656  -.2961062   (<span class="kw">N</span>)</span>
<span id="cb63-397"><a href="#cb63-397" aria-hidden="true" tabindex="-1"></a>##              |                                      -.5188768  -.2992493   (P)</span>
<span id="cb63-398"><a href="#cb63-398" aria-hidden="true" tabindex="-1"></a>##              |                                       -.507547  -.2924751  (BC)</span>
<span id="cb63-399"><a href="#cb63-399" aria-hidden="true" tabindex="-1"></a>##          age |   .20868084  -.0009771   .04306157    .1242817     .29308   (<span class="kw">N</span>)</span>
<span id="cb63-400"><a href="#cb63-400" aria-hidden="true" tabindex="-1"></a>##              |                                        .117856   .2910675   (P)</span>
<span id="cb63-401"><a href="#cb63-401" aria-hidden="true" tabindex="-1"></a>##              |                                       .1173203   .2900742  (BC)</span>
<span id="cb63-402"><a href="#cb63-402" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.5025044   .0024019   .59578279    3.334792   5.670217   (<span class="kw">N</span>)</span>
<span id="cb63-403"><a href="#cb63-403" aria-hidden="true" tabindex="-1"></a>##              |                                       3.368253   5.692966   (P)</span>
<span id="cb63-404"><a href="#cb63-404" aria-hidden="true" tabindex="-1"></a>##              |                                       3.405528   5.748656  (BC)</span>
<span id="cb63-405"><a href="#cb63-405" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.682253   .1759177   3.4552918    39.91001    53.4545   (<span class="kw">N</span>)</span>
<span id="cb63-406"><a href="#cb63-406" aria-hidden="true" tabindex="-1"></a>##              |                                       40.42489   54.07221   (P)</span>
<span id="cb63-407"><a href="#cb63-407" aria-hidden="true" tabindex="-1"></a>##              |                                       39.84275   53.29212  (BC)</span>
<span id="cb63-408"><a href="#cb63-408" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-409"><a href="#cb63-409" aria-hidden="true" tabindex="-1"></a>## Key:  <span class="kw">N</span>: Normal</span>
<span id="cb63-410"><a href="#cb63-410" aria-hidden="true" tabindex="-1"></a>##       P: Percentile</span>
<span id="cb63-411"><a href="#cb63-411" aria-hidden="true" tabindex="-1"></a>##      BC: Bias-corrected</span>
<span id="cb63-412"><a href="#cb63-412" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-413"><a href="#cb63-413" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-414"><a href="#cb63-414" aria-hidden="true" tabindex="-1"></a>## (running <span class="kw">regress</span> <span class="kw">on</span> estimation <span class="kw">sample</span>)</span>
<span id="cb63-415"><a href="#cb63-415" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-416"><a href="#cb63-416" aria-hidden="true" tabindex="-1"></a>## Bootstrap replications (1,000)</span>
<span id="cb63-417"><a href="#cb63-417" aria-hidden="true" tabindex="-1"></a>## ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 </span>
<span id="cb63-418"><a href="#cb63-418" aria-hidden="true" tabindex="-1"></a>## ..................................................    50</span>
<span id="cb63-419"><a href="#cb63-419" aria-hidden="true" tabindex="-1"></a>## ..................................................   100</span>
<span id="cb63-420"><a href="#cb63-420" aria-hidden="true" tabindex="-1"></a>## ..................................................   150</span>
<span id="cb63-421"><a href="#cb63-421" aria-hidden="true" tabindex="-1"></a>## ..................................................   200</span>
<span id="cb63-422"><a href="#cb63-422" aria-hidden="true" tabindex="-1"></a>## ..................................................   250</span>
<span id="cb63-423"><a href="#cb63-423" aria-hidden="true" tabindex="-1"></a>## ..................................................   300</span>
<span id="cb63-424"><a href="#cb63-424" aria-hidden="true" tabindex="-1"></a>## ..................................................   350</span>
<span id="cb63-425"><a href="#cb63-425" aria-hidden="true" tabindex="-1"></a>## ..................................................   400</span>
<span id="cb63-426"><a href="#cb63-426" aria-hidden="true" tabindex="-1"></a>## ..................................................   450</span>
<span id="cb63-427"><a href="#cb63-427" aria-hidden="true" tabindex="-1"></a>## ..................................................   500</span>
<span id="cb63-428"><a href="#cb63-428" aria-hidden="true" tabindex="-1"></a>## ..................................................   550</span>
<span id="cb63-429"><a href="#cb63-429" aria-hidden="true" tabindex="-1"></a>## ..................................................   600</span>
<span id="cb63-430"><a href="#cb63-430" aria-hidden="true" tabindex="-1"></a>## ..................................................   650</span>
<span id="cb63-431"><a href="#cb63-431" aria-hidden="true" tabindex="-1"></a>## ..................................................   700</span>
<span id="cb63-432"><a href="#cb63-432" aria-hidden="true" tabindex="-1"></a>## ..................................................   750</span>
<span id="cb63-433"><a href="#cb63-433" aria-hidden="true" tabindex="-1"></a>## ..................................................   800</span>
<span id="cb63-434"><a href="#cb63-434" aria-hidden="true" tabindex="-1"></a>## ..................................................   850</span>
<span id="cb63-435"><a href="#cb63-435" aria-hidden="true" tabindex="-1"></a>## ..................................................   900</span>
<span id="cb63-436"><a href="#cb63-436" aria-hidden="true" tabindex="-1"></a>## ..................................................   950</span>
<span id="cb63-437"><a href="#cb63-437" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,000</span>
<span id="cb63-438"><a href="#cb63-438" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-439"><a href="#cb63-439" aria-hidden="true" tabindex="-1"></a>## Linear regression                                      Number <span class="kw">of</span> <span class="kw">obs</span> =   2,021</span>
<span id="cb63-440"><a href="#cb63-440" aria-hidden="true" tabindex="-1"></a>##                                                        Replications  =   1,000</span>
<span id="cb63-441"><a href="#cb63-441" aria-hidden="true" tabindex="-1"></a>##                                                        Wald <span class="fu">chi2</span>(3)  =  122.77</span>
<span id="cb63-442"><a href="#cb63-442" aria-hidden="true" tabindex="-1"></a>##                                                        Prob &gt; <span class="fu">chi2</span>   =  0.0000</span>
<span id="cb63-443"><a href="#cb63-443" aria-hidden="true" tabindex="-1"></a>##                                                        R-squared     =  0.0652</span>
<span id="cb63-444"><a href="#cb63-444" aria-hidden="true" tabindex="-1"></a>##                                                        Adj R-squared =  0.0638</span>
<span id="cb63-445"><a href="#cb63-445" aria-hidden="true" tabindex="-1"></a>##                                                        Root MSE      = 13.0608</span>
<span id="cb63-446"><a href="#cb63-446" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-447"><a href="#cb63-447" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-448"><a href="#cb63-448" aria-hidden="true" tabindex="-1"></a>##              |   Observed   Bootstrap                         Normal-based</span>
<span id="cb63-449"><a href="#cb63-449" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb63-450"><a href="#cb63-450" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-451"><a href="#cb63-451" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.4036859   .0548886    -7.35   0.000    -.5112656   -.2961062</span>
<span id="cb63-452"><a href="#cb63-452" aria-hidden="true" tabindex="-1"></a>##          age |   .2086808   .0430616     4.85   0.000     .1242817      .29308</span>
<span id="cb63-453"><a href="#cb63-453" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.502504   .5957828     7.56   0.000     3.334792    5.670217</span>
<span id="cb63-454"><a href="#cb63-454" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.68225   3.455292    13.51   0.000     39.91001     53.4545</span>
<span id="cb63-455"><a href="#cb63-455" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-456"><a href="#cb63-456" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-457"><a href="#cb63-457" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-458"><a href="#cb63-458" aria-hidden="true" tabindex="-1"></a>## Linear regression                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,021</span>
<span id="cb63-459"><a href="#cb63-459" aria-hidden="true" tabindex="-1"></a>##                                                 Replications      =       1000</span>
<span id="cb63-460"><a href="#cb63-460" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-461"><a href="#cb63-461" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-462"><a href="#cb63-462" aria-hidden="true" tabindex="-1"></a>##              |    Observed               Bootstrap</span>
<span id="cb63-463"><a href="#cb63-463" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient       Bias    <span class="fu">std</span>. err.  [95% conf. interval]</span>
<span id="cb63-464"><a href="#cb63-464" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-465"><a href="#cb63-465" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.40368587  -.0038854    .0548886   -.5188768  -.2992493   (P)</span>
<span id="cb63-466"><a href="#cb63-466" aria-hidden="true" tabindex="-1"></a>##          age |   .20868084  -.0009771   .04306157     .117856   .2910675   (P)</span>
<span id="cb63-467"><a href="#cb63-467" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.5025044   .0024019   .59578279    3.368253   5.692966   (P)</span>
<span id="cb63-468"><a href="#cb63-468" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.682253   .1759177   3.4552918    40.42489   54.07221   (P)</span>
<span id="cb63-469"><a href="#cb63-469" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-470"><a href="#cb63-470" aria-hidden="true" tabindex="-1"></a>## Key: P: Percentile</span>
<span id="cb63-471"><a href="#cb63-471" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-472"><a href="#cb63-472" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-473"><a href="#cb63-473" aria-hidden="true" tabindex="-1"></a>## (running <span class="kw">regress</span> <span class="kw">on</span> estimation <span class="kw">sample</span>)</span>
<span id="cb63-474"><a href="#cb63-474" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-475"><a href="#cb63-475" aria-hidden="true" tabindex="-1"></a>## Bootstrap replications (1,000)</span>
<span id="cb63-476"><a href="#cb63-476" aria-hidden="true" tabindex="-1"></a>## ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 </span>
<span id="cb63-477"><a href="#cb63-477" aria-hidden="true" tabindex="-1"></a>## ..................................................    50</span>
<span id="cb63-478"><a href="#cb63-478" aria-hidden="true" tabindex="-1"></a>## ..................................................   100</span>
<span id="cb63-479"><a href="#cb63-479" aria-hidden="true" tabindex="-1"></a>## ..................................................   150</span>
<span id="cb63-480"><a href="#cb63-480" aria-hidden="true" tabindex="-1"></a>## ..................................................   200</span>
<span id="cb63-481"><a href="#cb63-481" aria-hidden="true" tabindex="-1"></a>## ..................................................   250</span>
<span id="cb63-482"><a href="#cb63-482" aria-hidden="true" tabindex="-1"></a>## ..................................................   300</span>
<span id="cb63-483"><a href="#cb63-483" aria-hidden="true" tabindex="-1"></a>## ..................................................   350</span>
<span id="cb63-484"><a href="#cb63-484" aria-hidden="true" tabindex="-1"></a>## ..................................................   400</span>
<span id="cb63-485"><a href="#cb63-485" aria-hidden="true" tabindex="-1"></a>## ..................................................   450</span>
<span id="cb63-486"><a href="#cb63-486" aria-hidden="true" tabindex="-1"></a>## ..................................................   500</span>
<span id="cb63-487"><a href="#cb63-487" aria-hidden="true" tabindex="-1"></a>## ..................................................   550</span>
<span id="cb63-488"><a href="#cb63-488" aria-hidden="true" tabindex="-1"></a>## ..................................................   600</span>
<span id="cb63-489"><a href="#cb63-489" aria-hidden="true" tabindex="-1"></a>## ..................................................   650</span>
<span id="cb63-490"><a href="#cb63-490" aria-hidden="true" tabindex="-1"></a>## ..................................................   700</span>
<span id="cb63-491"><a href="#cb63-491" aria-hidden="true" tabindex="-1"></a>## ..................................................   750</span>
<span id="cb63-492"><a href="#cb63-492" aria-hidden="true" tabindex="-1"></a>## ..................................................   800</span>
<span id="cb63-493"><a href="#cb63-493" aria-hidden="true" tabindex="-1"></a>## ..................................................   850</span>
<span id="cb63-494"><a href="#cb63-494" aria-hidden="true" tabindex="-1"></a>## ..................................................   900</span>
<span id="cb63-495"><a href="#cb63-495" aria-hidden="true" tabindex="-1"></a>## ..................................................   950</span>
<span id="cb63-496"><a href="#cb63-496" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,000</span>
<span id="cb63-497"><a href="#cb63-497" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-498"><a href="#cb63-498" aria-hidden="true" tabindex="-1"></a>## Linear regression                                      Number <span class="kw">of</span> <span class="kw">obs</span> =   2,021</span>
<span id="cb63-499"><a href="#cb63-499" aria-hidden="true" tabindex="-1"></a>##                                                        Replications  =   1,000</span>
<span id="cb63-500"><a href="#cb63-500" aria-hidden="true" tabindex="-1"></a>##                                                        Wald <span class="fu">chi2</span>(3)  =  122.77</span>
<span id="cb63-501"><a href="#cb63-501" aria-hidden="true" tabindex="-1"></a>##                                                        Prob &gt; <span class="fu">chi2</span>   =  0.0000</span>
<span id="cb63-502"><a href="#cb63-502" aria-hidden="true" tabindex="-1"></a>##                                                        R-squared     =  0.0652</span>
<span id="cb63-503"><a href="#cb63-503" aria-hidden="true" tabindex="-1"></a>##                                                        Adj R-squared =  0.0638</span>
<span id="cb63-504"><a href="#cb63-504" aria-hidden="true" tabindex="-1"></a>##                                                        Root MSE      = 13.0608</span>
<span id="cb63-505"><a href="#cb63-505" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-506"><a href="#cb63-506" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-507"><a href="#cb63-507" aria-hidden="true" tabindex="-1"></a>##              |   Observed   Bootstrap                         Normal-based</span>
<span id="cb63-508"><a href="#cb63-508" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb63-509"><a href="#cb63-509" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-510"><a href="#cb63-510" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.4036859   .0548886    -7.35   0.000    -.5112656   -.2961062</span>
<span id="cb63-511"><a href="#cb63-511" aria-hidden="true" tabindex="-1"></a>##          age |   .2086808   .0430616     4.85   0.000     .1242817      .29308</span>
<span id="cb63-512"><a href="#cb63-512" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.502504   .5957828     7.56   0.000     3.334792    5.670217</span>
<span id="cb63-513"><a href="#cb63-513" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.68225   3.455292    13.51   0.000     39.91001     53.4545</span>
<span id="cb63-514"><a href="#cb63-514" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-515"><a href="#cb63-515" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-516"><a href="#cb63-516" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-517"><a href="#cb63-517" aria-hidden="true" tabindex="-1"></a>## Linear regression                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,021</span>
<span id="cb63-518"><a href="#cb63-518" aria-hidden="true" tabindex="-1"></a>##                                                 Replications      =       1000</span>
<span id="cb63-519"><a href="#cb63-519" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-520"><a href="#cb63-520" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-521"><a href="#cb63-521" aria-hidden="true" tabindex="-1"></a>##              |    Observed               Bootstrap</span>
<span id="cb63-522"><a href="#cb63-522" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient       Bias    <span class="fu">std</span>. err.  [95% conf. interval]</span>
<span id="cb63-523"><a href="#cb63-523" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-524"><a href="#cb63-524" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.40368587  -.0038854    .0548886   -.5112656  -.2961062   (<span class="kw">N</span>)</span>
<span id="cb63-525"><a href="#cb63-525" aria-hidden="true" tabindex="-1"></a>##          age |   .20868084  -.0009771   .04306157    .1242817     .29308   (<span class="kw">N</span>)</span>
<span id="cb63-526"><a href="#cb63-526" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.5025044   .0024019   .59578279    3.334792   5.670217   (<span class="kw">N</span>)</span>
<span id="cb63-527"><a href="#cb63-527" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.682253   .1759177   3.4552918    39.91001    53.4545   (<span class="kw">N</span>)</span>
<span id="cb63-528"><a href="#cb63-528" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-529"><a href="#cb63-529" aria-hidden="true" tabindex="-1"></a>## Key: <span class="kw">N</span>: Normal</span>
<span id="cb63-530"><a href="#cb63-530" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-531"><a href="#cb63-531" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-532"><a href="#cb63-532" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span>
<span id="cb63-533"><a href="#cb63-533" aria-hidden="true" tabindex="-1"></a>## (running <span class="kw">regress</span> <span class="kw">on</span> estimation <span class="kw">sample</span>)</span>
<span id="cb63-534"><a href="#cb63-534" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-535"><a href="#cb63-535" aria-hidden="true" tabindex="-1"></a>## Jackknife replications (2,021)</span>
<span id="cb63-536"><a href="#cb63-536" aria-hidden="true" tabindex="-1"></a>## ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 </span>
<span id="cb63-537"><a href="#cb63-537" aria-hidden="true" tabindex="-1"></a>## ..................................................    50</span>
<span id="cb63-538"><a href="#cb63-538" aria-hidden="true" tabindex="-1"></a>## ..................................................   100</span>
<span id="cb63-539"><a href="#cb63-539" aria-hidden="true" tabindex="-1"></a>## ..................................................   150</span>
<span id="cb63-540"><a href="#cb63-540" aria-hidden="true" tabindex="-1"></a>## ..................................................   200</span>
<span id="cb63-541"><a href="#cb63-541" aria-hidden="true" tabindex="-1"></a>## ..................................................   250</span>
<span id="cb63-542"><a href="#cb63-542" aria-hidden="true" tabindex="-1"></a>## ..................................................   300</span>
<span id="cb63-543"><a href="#cb63-543" aria-hidden="true" tabindex="-1"></a>## ..................................................   350</span>
<span id="cb63-544"><a href="#cb63-544" aria-hidden="true" tabindex="-1"></a>## ..................................................   400</span>
<span id="cb63-545"><a href="#cb63-545" aria-hidden="true" tabindex="-1"></a>## ..................................................   450</span>
<span id="cb63-546"><a href="#cb63-546" aria-hidden="true" tabindex="-1"></a>## ..................................................   500</span>
<span id="cb63-547"><a href="#cb63-547" aria-hidden="true" tabindex="-1"></a>## ..................................................   550</span>
<span id="cb63-548"><a href="#cb63-548" aria-hidden="true" tabindex="-1"></a>## ..................................................   600</span>
<span id="cb63-549"><a href="#cb63-549" aria-hidden="true" tabindex="-1"></a>## ..................................................   650</span>
<span id="cb63-550"><a href="#cb63-550" aria-hidden="true" tabindex="-1"></a>## ..................................................   700</span>
<span id="cb63-551"><a href="#cb63-551" aria-hidden="true" tabindex="-1"></a>## ..................................................   750</span>
<span id="cb63-552"><a href="#cb63-552" aria-hidden="true" tabindex="-1"></a>## ..................................................   800</span>
<span id="cb63-553"><a href="#cb63-553" aria-hidden="true" tabindex="-1"></a>## ..................................................   850</span>
<span id="cb63-554"><a href="#cb63-554" aria-hidden="true" tabindex="-1"></a>## ..................................................   900</span>
<span id="cb63-555"><a href="#cb63-555" aria-hidden="true" tabindex="-1"></a>## ..................................................   950</span>
<span id="cb63-556"><a href="#cb63-556" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,000</span>
<span id="cb63-557"><a href="#cb63-557" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,050</span>
<span id="cb63-558"><a href="#cb63-558" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,100</span>
<span id="cb63-559"><a href="#cb63-559" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,150</span>
<span id="cb63-560"><a href="#cb63-560" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,200</span>
<span id="cb63-561"><a href="#cb63-561" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,250</span>
<span id="cb63-562"><a href="#cb63-562" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,300</span>
<span id="cb63-563"><a href="#cb63-563" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,350</span>
<span id="cb63-564"><a href="#cb63-564" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,400</span>
<span id="cb63-565"><a href="#cb63-565" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,450</span>
<span id="cb63-566"><a href="#cb63-566" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,500</span>
<span id="cb63-567"><a href="#cb63-567" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,550</span>
<span id="cb63-568"><a href="#cb63-568" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,600</span>
<span id="cb63-569"><a href="#cb63-569" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,650</span>
<span id="cb63-570"><a href="#cb63-570" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,700</span>
<span id="cb63-571"><a href="#cb63-571" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,750</span>
<span id="cb63-572"><a href="#cb63-572" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,800</span>
<span id="cb63-573"><a href="#cb63-573" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,850</span>
<span id="cb63-574"><a href="#cb63-574" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,900</span>
<span id="cb63-575"><a href="#cb63-575" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,950</span>
<span id="cb63-576"><a href="#cb63-576" aria-hidden="true" tabindex="-1"></a>## .................................................. 2,000</span>
<span id="cb63-577"><a href="#cb63-577" aria-hidden="true" tabindex="-1"></a>## .....................</span>
<span id="cb63-578"><a href="#cb63-578" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-579"><a href="#cb63-579" aria-hidden="true" tabindex="-1"></a>## Bootstrap replications (1,000)</span>
<span id="cb63-580"><a href="#cb63-580" aria-hidden="true" tabindex="-1"></a>## ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 </span>
<span id="cb63-581"><a href="#cb63-581" aria-hidden="true" tabindex="-1"></a>## ..................................................    50</span>
<span id="cb63-582"><a href="#cb63-582" aria-hidden="true" tabindex="-1"></a>## ..................................................   100</span>
<span id="cb63-583"><a href="#cb63-583" aria-hidden="true" tabindex="-1"></a>## ..................................................   150</span>
<span id="cb63-584"><a href="#cb63-584" aria-hidden="true" tabindex="-1"></a>## ..................................................   200</span>
<span id="cb63-585"><a href="#cb63-585" aria-hidden="true" tabindex="-1"></a>## ..................................................   250</span>
<span id="cb63-586"><a href="#cb63-586" aria-hidden="true" tabindex="-1"></a>## ..................................................   300</span>
<span id="cb63-587"><a href="#cb63-587" aria-hidden="true" tabindex="-1"></a>## ..................................................   350</span>
<span id="cb63-588"><a href="#cb63-588" aria-hidden="true" tabindex="-1"></a>## ..................................................   400</span>
<span id="cb63-589"><a href="#cb63-589" aria-hidden="true" tabindex="-1"></a>## ..................................................   450</span>
<span id="cb63-590"><a href="#cb63-590" aria-hidden="true" tabindex="-1"></a>## ..................................................   500</span>
<span id="cb63-591"><a href="#cb63-591" aria-hidden="true" tabindex="-1"></a>## ..................................................   550</span>
<span id="cb63-592"><a href="#cb63-592" aria-hidden="true" tabindex="-1"></a>## ..................................................   600</span>
<span id="cb63-593"><a href="#cb63-593" aria-hidden="true" tabindex="-1"></a>## ..................................................   650</span>
<span id="cb63-594"><a href="#cb63-594" aria-hidden="true" tabindex="-1"></a>## ..................................................   700</span>
<span id="cb63-595"><a href="#cb63-595" aria-hidden="true" tabindex="-1"></a>## ..................................................   750</span>
<span id="cb63-596"><a href="#cb63-596" aria-hidden="true" tabindex="-1"></a>## ..................................................   800</span>
<span id="cb63-597"><a href="#cb63-597" aria-hidden="true" tabindex="-1"></a>## ..................................................   850</span>
<span id="cb63-598"><a href="#cb63-598" aria-hidden="true" tabindex="-1"></a>## ..................................................   900</span>
<span id="cb63-599"><a href="#cb63-599" aria-hidden="true" tabindex="-1"></a>## ..................................................   950</span>
<span id="cb63-600"><a href="#cb63-600" aria-hidden="true" tabindex="-1"></a>## .................................................. 1,000</span>
<span id="cb63-601"><a href="#cb63-601" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-602"><a href="#cb63-602" aria-hidden="true" tabindex="-1"></a>## Linear regression                                      Number <span class="kw">of</span> <span class="kw">obs</span> =   2,021</span>
<span id="cb63-603"><a href="#cb63-603" aria-hidden="true" tabindex="-1"></a>##                                                        Replications  =   1,000</span>
<span id="cb63-604"><a href="#cb63-604" aria-hidden="true" tabindex="-1"></a>##                                                        Wald <span class="fu">chi2</span>(3)  =  122.77</span>
<span id="cb63-605"><a href="#cb63-605" aria-hidden="true" tabindex="-1"></a>##                                                        Prob &gt; <span class="fu">chi2</span>   =  0.0000</span>
<span id="cb63-606"><a href="#cb63-606" aria-hidden="true" tabindex="-1"></a>##                                                        R-squared     =  0.0652</span>
<span id="cb63-607"><a href="#cb63-607" aria-hidden="true" tabindex="-1"></a>##                                                        Adj R-squared =  0.0638</span>
<span id="cb63-608"><a href="#cb63-608" aria-hidden="true" tabindex="-1"></a>##                                                        Root MSE      = 13.0608</span>
<span id="cb63-609"><a href="#cb63-609" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-610"><a href="#cb63-610" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-611"><a href="#cb63-611" aria-hidden="true" tabindex="-1"></a>##              |   Observed   Bootstrap                         Normal-based</span>
<span id="cb63-612"><a href="#cb63-612" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb63-613"><a href="#cb63-613" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-614"><a href="#cb63-614" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.4036859   .0548886    -7.35   0.000    -.5112656   -.2961062</span>
<span id="cb63-615"><a href="#cb63-615" aria-hidden="true" tabindex="-1"></a>##          age |   .2086808   .0430616     4.85   0.000     .1242817      .29308</span>
<span id="cb63-616"><a href="#cb63-616" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.502504   .5957828     7.56   0.000     3.334792    5.670217</span>
<span id="cb63-617"><a href="#cb63-617" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.68225   3.455292    13.51   0.000     39.91001     53.4545</span>
<span id="cb63-618"><a href="#cb63-618" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-619"><a href="#cb63-619" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-620"><a href="#cb63-620" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-621"><a href="#cb63-621" aria-hidden="true" tabindex="-1"></a>## Linear regression                               Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,021</span>
<span id="cb63-622"><a href="#cb63-622" aria-hidden="true" tabindex="-1"></a>##                                                 Replications      =       1000</span>
<span id="cb63-623"><a href="#cb63-623" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-624"><a href="#cb63-624" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-625"><a href="#cb63-625" aria-hidden="true" tabindex="-1"></a>##              |    Observed               Bootstrap</span>
<span id="cb63-626"><a href="#cb63-626" aria-hidden="true" tabindex="-1"></a>##          HDL | coefficient       Bias    <span class="fu">std</span>. err.  [95% conf. interval]</span>
<span id="cb63-627"><a href="#cb63-627" aria-hidden="true" tabindex="-1"></a>## -------------+----------------------------------------------------------------</span>
<span id="cb63-628"><a href="#cb63-628" aria-hidden="true" tabindex="-1"></a>##          BMI |  -.40368587  -.0038854    .0548886    -.507547  -.2924751  (BC)</span>
<span id="cb63-629"><a href="#cb63-629" aria-hidden="true" tabindex="-1"></a>##          age |   .20868084  -.0009771   .04306157    .1173203   .2900742  (BC)</span>
<span id="cb63-630"><a href="#cb63-630" aria-hidden="true" tabindex="-1"></a>##     drinkany |   4.5025044   .0024019   .59578279    3.405528   5.748656  (BC)</span>
<span id="cb63-631"><a href="#cb63-631" aria-hidden="true" tabindex="-1"></a>##        <span class="dt">_cons</span> |   46.682253   .1759177   3.4552918    39.84275   53.29212  (BC)</span>
<span id="cb63-632"><a href="#cb63-632" aria-hidden="true" tabindex="-1"></a>## ------------------------------------------------------------------------------</span>
<span id="cb63-633"><a href="#cb63-633" aria-hidden="true" tabindex="-1"></a>## Key: BC: Bias-corrected</span>
<span id="cb63-634"><a href="#cb63-634" aria-hidden="true" tabindex="-1"></a>## </span>
<span id="cb63-635"><a href="#cb63-635" aria-hidden="true" tabindex="-1"></a>## Unknown #command</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To understand better how the bootstrap works in linear regression, we ask to carry out the following tasks:</p>
<ol type="1">
<li><p>First, run a multiple linear regression of <em>HDL</em> on <em>BMI</em>, <em>age</em> and <em>drinkany</em> after removing diabetic patients. For simplicity we consider only 3 covariates but this can be extended to a more complex model. Create a <em>reduced dataset</em> with only these four variables and <em>no missing data</em> before any further treatment (since bootstrapping cannot accommodate missing data). You should get <em>n=2021</em> observations. Compute the residuals and observe that there is a bit of curvature on the normal <span class="math inline">\(QQ\)</span>-plot.</p></li>
<li><p>Given the large sample size, normality is not that critical but we are going to check that inference is indeed valid using the bootstrap. Read Part A) of the code above explaining how we can resample the data and calculate <span class="math inline">\(R\)</span> replicates (here <span class="math inline">\(R=1000\)</span>) of the coefficients. Run the corresponding code and draw a histogram of the bootstrap samples (or replicates) for each of the coefficients.</p></li>
<li><p>Can you provide the percentile 95% CI <em>directly</em> (using a one-line command in R/Stata) for each of the 3 coefficients? Compare with what Stata/R gives you using the code provided (NB: R users will have to use the package <em>boot</em> to get results - see next question)</p></li>
<li><p>Fortunately, both Stata and R have a built-in command that avoids having to do the resampling ``by hand’’. Use Part B) of the code to provide the 3 types of bootstrap 95% cI. Do you see any meaningful difference with the standard LS analysis?</p></li>
</ol>
<!-- 5) Optional: Modify Part A) to provide a bootstrap-based 95\% CI for the predicted $HDL$ of a patient having the following characteristics: $BMI=27$, $age=65$ and $drinkany=1$. Compare with the standard 95\% CI. -->
</section>
<section id="heteroscedasticity" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="heteroscedasticity">Heteroscedasticity</h3>
<p>As discussed over the previous weeks, a critical assumption for the normal theory or even the bootstrap methods to be valid is the assumption of constant variance of the error term. What can we do if this assumption is not met? A standard way to deal with this issue (known as heteroscedasticity) is to transform the endpoint but such a variance-stabilising transformation does not always exists. Another way is to use weighted LS that provide valid inference in situations where the variance of the error term is <span class="math inline">\(var(\varepsilon)=\sigma^2 W^{-1}\)</span>, the only issue with this approach is to find a proper symmetric matrix <span class="math inline">\(W\)</span> often chosen diagonal. Its choice can be driven by plots, for instance plot of residuals vs covariate but it’s not always straighforward. Ather convenient means of dealing with nonconstant residual variance is to use the so-called ``robust’’ variance matrix due to White. The corresponding SEs allows reliable inference when the constant-variance assumption is violated.</p>
<p>This little technial note explains how this can be done: robust SEs be calculated in Stata using the option <em>vce(robust)</em> of <em>regress</em> with a more accurate version <em>vce(hc3)</em> being preferable in small samples. R users can install the libraries <em>sandwich</em> and <em>lmtest</em> and then use <em>vcovHC</em>. The same options and a few other alternatives can be obtained through a command like this: <em>coeftest(m, vcov. = vcovHC(m, type = ‘HC3’))</em> where <em>type = “HC3”</em> specifies the chosen option, here the same as Stata’s <em>vce(hc3)</em>. The command to match Stata’s output for the 95% CI is: <em>coefci(out, vcov. = vcovHC(out, type = ‘HC3’))</em>. Of course, the object <em>out</em> contains the result of the initial <em>lm</em> fit. We let you explore these options, for instance, you can reproduce the fits given p.&nbsp;123 of Vittinghof et al.&nbsp;(2012) using the <em>hers</em> dataset and the appropriate sandwich matrix. A textbook example is given in the second lecture so you can also explore that example.</p>
</section>
</section>
<section id="summary_wk11" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="summary_wk11">Summary</h2>
<p>This weeks key concepts are:</p>
<div id="box1" class="green-box">
<p>The following are the key takeaway messages from this week:</p>
<ol type="1">
<li><p>Polynomial regression and RCS are powerful tools to capture nonlinearities</p></li>
<li><p>RCS and fractional polynomials are part of a suite of flexible techniques that can be used to model complex relationships</p></li>
<li><p>The bootstrap provides an alternative way to draw inference in situations where the normality assumption is questionable. It can also be used to get SEs for complex statistics.</p></li>
<li><p>Sandwich formulas exist to cope with hererescedasticity issues (e.g.&nbsp;non constant variance) when no variance-stabilising transformation exists.</p></li>
</ol>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./006-interaction_collinearity.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Interaction and Collinearity</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./008-model_building.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regression model building and variable selection</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>